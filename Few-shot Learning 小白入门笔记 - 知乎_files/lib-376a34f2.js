(self.webpackChunkheifetz=self.webpackChunkheifetz||[]).push([[7656],{34099:function(e,t,i){!function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e,t,i,n){return new(i=i||Promise)((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function o(e,t){var i,n,o,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){var l=[s,c];if(i)throw new TypeError("Generator is already executing.");for(;r=a&&l[a=0]?0:r;)try{if(i=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,(l=o?[2&l[0],o.value]:l)[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(o=0<(o=r.trys).length&&o[o.length-1])&&(6===l[0]||2===l[0])){r=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3]))r.label=l[1];else if(6===l[0]&&r.label<o[1])r.label=o[1],o=l;else{if(!(o&&r.label<o[2])){o[2]&&r.ops.pop(),r.trys.pop();continue}r.label=o[2],r.ops.push(l)}}l=t.call(e,r)}catch(c){l=[6,c],n=0}finally{i=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function r(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=r.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return a}function a(e,t,i){if(i||2===arguments.length)for(var n,o=0,r=t.length;o<r;o++)!n&&o in t||((n=n||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}var s={cn:"//imagex-web-settings.volcimagex.net/app/monitor/settings",va:"//imagex-web-settings-va.volcimagex.net/app/monitor/settings",sg:"//imagex-web-settings-sg.volcimagex.net/app/monitor/settings",default:"//imagex-web-settings.volcimagex.net/app/monitor/settings"},c={reportRateConfig:{reportRate:1,reportRateError:1}},l="SOURCE_NOT_FOUND",h="NETWORK_TIMEOUT",u="TYPE_ERR_NOT_IMG",p="MISSING_DECODER",f="ERROR_DECODER",d="ERROR_SYSTEM_INIT",g="ERROR_SYSTEM_OBS",m="ERROR_SYSTEM_SECTION",_="UNKNOWN",v=((He={}).NETWORK_ERR=1001,He[l]=1002,He[h]=1003,He[u]=2001,He[p]=3001,He[f]=3002,He[d]=5001,He[g]=5002,He[m]=5003,He[_]=6001,He),y="success",b="fail",E={504:"Gateway Timeout",503:"Service Unavailable",502:"Bad Gateway",500:"Internal Server Error",451:"Unavailable For Legal Reasons",429:"Too Many Requests",424:"Failed Dependency",412:"Precondition Failed",408:"Request Timeout",406:"Not Acceptable",404:"Not Found",403:"Forbidden",401:"Unauthorized",400:"Bad Request"};function w(e){return e<1?1:Math.round(e)}function S(e){return e?1/e:0}function k(e){return e&&"object"==typeof e&&!Array.isArray(e)}function T(e){for(var t,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(!i.length)return e;var o=i.shift();if(k(e)&&k(o))for(var s in o)k(o[s])?(e[s]||Object.assign(e,((t={})[s]={},t)),T(e[s],o[s])):Object.assign(e,((t={})[s]=o[s],t));return T.apply(void 0,a([e],r(i),!1))}function A(e){if("object"!=typeof e)return e;for(var t=function(e){for(var t=Object.keys(e),i=[],n=0;n<t.length;n++)i.push([t[n],e[t[n]]]);return i}(e).filter((function(e){return(e=r(e,2))[0],null!=(e=e[1])})),i={},n=0;n<t.length;n++)i[t[n][0]]=t[n][1];return i}function D(e){try{return localStorage.getItem("IMAGEX_MONITOR_DEBUG_SIGNAL")?function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return console.log.apply(console,a(["[".concat(e,"] ")],r(t),!1))}:function(){}}catch(e){return function(){}}}function O(e){return"img"===e.nodeName.toLocaleLowerCase()}function C(e,t){void 0===t&&(t="img");var i=[];return Array.from(e).forEach((function(e){e instanceof Element&&(O(e)?i.push(e):null!=e&&e.querySelectorAll&&(e=e.querySelectorAll("img"),i=i.concat(Array.from(e))))})),i.filter((function(e){return e.matches(t)}))}x.prototype.initCloudConfigSchedule=function(){var e,t,i=this;null!=(e=this.options.cloudConfig)&&e.channel&&null!=(e=this.options.cloudConfig)&&e.app_id&&(this.url=new URL("".concat(location.protocol).concat(s[this.options.cloudConfig.channel]||s.default)),t={aid:this.options.cloudConfig.app_id,os:"web"},Object.keys(t).forEach((function(e){return i.url.searchParams.append(e,t[e])})),this.startUpdateSchedule())},x.prototype.startUpdateSchedule=function(){var e;return n(this,void 0,void 0,(function(){var t,i,n=this;return o(this,(function(o){switch(o.label){case 0:return[4,this.getCloudConfig()];case 1:return(t=o.sent())&&(this.updateConfig("reportRateConfig",t.reportRateConfig),this.updateConfig("fetchInterval",t.fetchInterval),null!=(i=null==(e=this.options.cloudConfig)?void 0:e.callback))&&i(t),setTimeout((function(){return n.startUpdateSchedule()}),1e3*t.fetchInterval),[2]}}))}))},x.prototype.getCloudConfig=function(){var e;return n(this,void 0,void 0,(function(){var t,i,n;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch(this.url.toString())];case 1:return[4,o.sent().json()];case 2:return(n=(n=o.sent()).data)?(i=null==(e=n.custom_settings)?void 0:e.allow_log_type,t=null==i?void 0:i.imagex_load_monitor,i=null==i?void 0:i.imagex_load_monitor_error,n=(null==(e=null==n?void 0:n.general_settings)?void 0:e.fetch_settings_interval)||3600,[2,{reportRateConfig:{reportRate:t,reportRateError:i},fetchInterval:n}]):[2];case 3:return o.sent(),console.error("[ConfigProvider] fetch cloud config failed"),[2];case 4:return[2]}}))}))},x.initConfigProvider=function(e){return this.instance||(this.instance=new x(e)),this.instance},x.getConfigProvider=function(){if(this.instance)return this.instance;throw new Error("[ConfigProvider]: init config provider first")},x.prototype.updateConfig=function(e,t){return this.configMap[e]=t,this.configMap[e]},x.prototype.getConfig=function(e){return this.configMap[e]};var I=x;function x(e){this.configMap={},this.options=e,this.configMap=T({},c,e.defaultConfig),this.initCloudConfigSchedule()}var M,R=D("MetricFormatter"),G=(P.getImageXParam=function(e){try{var t=new URLSearchParams(e.search);return{from:t.get("from")||"",imagex_flight_id:t.get("imagex_flight_id")||"",imagex_vid:t.get("imagex_vid")||"",biz_tag:t.get("biz_tag")||""}}catch(e){throw new Error("[MetricFormatter]: getImageXParam error")}},P.getProtocol=function(e){e=String(e);var t=location.protocol,i="http",n=/https/.test(e);return e=/http/.test(e),n&&(i="https"),!1===n&&!1===e?t.replace(":",""):i},P.formatPerformanceTiming=function(e){try{var t={};return t.timing_time_start=w(e.startTime),t.timing_redirect_start=w(e.redirectStart),t.timing_redirect_end=w(e.redirectEnd),t.timing_fetch_start=w(e.fetchStart),t.timing_dns_start=w(e.domainLookupStart),t.timing_dns_end=w(e.domainLookupEnd),t.timing_connect_start=w(e.connectStart),t.timing_connect_end=w(e.connectEnd),t.timing_secure_connection_start=w(e.secureConnectionStart),t.timing_request_start=w(e.requestStart),t.timing_request_end=w(e.responseStart),t.timing_response_start=w(e.responseStart),t.timing_response_end=w(e.responseEnd),t.timing_network_duration=w(e.duration),t.file_size=w(e.encodedBodySize),t.timing_connect=t.timing_connect_end-t.timing_connect_start,t.timing_dns=t.timing_dns_end-t.timing_dns_start,t.timing_ssl=t.timing_secure_connection_start?t.timing_request_start-t.timing_secure_connection_start:0,t.timing_send=t.timing_request_end-t.timing_request_start,t.timing_wait=t.timing_response_start?t.timing_response_end-t.timing_response_start:t.timing_network_duration,t.timing_receive=0,t.timing_total=t.timing_network_duration,t.timing_isSocketReused=!t.timing_connect,t.data_protocol=this.getProtocol(e.name),t.cache_seek_duration=t.timing_redirect_end-t.timing_redirect_start,t.server_ip="",t.duration=e.duration,R("performance timing map => ",t),t}catch(e){throw new Error("[MetricFormatter]: formatPerformanceTiming error")}},P.formatHeaders=function(e){try{var t=e.headers,i=e.status,n=t.get("x-response-sinfo")||"",o=t.get("x-response-cinfo")||"",r=t.get("x-response-cache")||"",a=t.get("content-type")||"",s="unknown",c=(a.split(";")[0].startsWith("image/")&&(s=a.split(";")[0].substring(6)),Number(t.get("content-length"))||0);return{http_status:i,image_type:s,response_sinfo:n,response_cache:r,response_cinfo:o,file_size:c}}catch(e){throw new Error("[MetricFormatter]: formatHeaders error")}},P.formatReportRateConfig=function(){try{var e=I.getConfigProvider().getConfig("reportRateConfig");return{report_rate:e.reportRate,report_rate_error:e.reportRateError,report_level:S(e.reportRate),report_level_error:S(e.reportRateError)}}catch(e){throw new Error("[MetricFormatter]: formatReportRateConfig error")}},P.format=function(e){var i=[],n=e.basicInfo,o=e.resourceTiming,r=(e=e.headers,o.name),a=new URL(r),s={};try{s=this.getImageXParam(a)}catch(e){i.push(e)}var c={};try{c=this.formatPerformanceTiming(o)}catch(e){i.push(e)}o={};try{o=e?this.formatHeaders(e):{}}catch(e){i.push(e)}e={};try{e=this.formatReportRateConfig()}catch(e){i.push(e)}return R("before process",s,n,c,o,e),(s=t(t(t(t(t(t({},s),n),c),o),e),{domain:a.host,uri:r,referrer:document.referrer,reffer:document.referrer,image_sdk_version:"2.0.2-v2"})).http_status?s.http_status<400?s.load_status=y:400<=s.http_status?(s.load_status=b,o=(c={code:n=s.http_status,desc:null!=(n=E[n])?n:"unknown"}).code,s.err_desc=c.desc,s.err_code=o):0<i.length&&R("errors => ",i):s.applied_image_size&&"0*0"===s.applied_image_size?(s.load_status=b,s.err_desc=_,s.err_code=v[_]):s.load_status=y,R("metrics => ",s),s},P);function P(){}(l=M=M||{}).Error="img_error",l.Monitor="img_monitor",l.System="img_system",N.initEventBroker=function(e){return this.instance||(this.instance=new N(e)),this.instance},N.getEventBroker=function(){if(this.instance)return this.instance;throw new Error("[EventBroker]: init config provider first")},N.prototype.getSamplingRate=function(){return this.configProvider.getConfig("reportRateConfig")},N.prototype.shouldReport=function(){var e;return Math.random()<=(null!=(e=null==(e=this.getSamplingRate())?void 0:e.reportRate)?e:1)},N.prototype.shouldReportError=function(){var e;return Math.random()<=(null!=(e=null==(e=this.getSamplingRate())?void 0:e.reportRateError)?e:1)},N.prototype.report=function(e){var t;switch(e.type){case M.Monitor:t=this.shouldReport();break;case M.Error:t=this.shouldReportError();break;default:t=!0}t?(this.logger("will report this event => ",e),this.tea.event(e.type,e.content)):this.logger("wont report this event => ",e)},N.prototype.formatInfo=function(e){return G.format(e)},N.prototype.receive=function(e){(e=this.formatInfo(e)).err_code&&this.receiveError(e),this.logger("receive log => ",e),this.report({type:M.Monitor,content:e})},N.prototype.receiveError=function(e){this.logger("receive error => ",e),this.report({type:M.Error,content:e})};var B=N;function N(e){this.tea=e.tea,this.configProvider=I.getConfigProvider(),this.logger=D("EventBroker")}var U={selector:"img"},V=(z.prototype.start=function(){this.logger("start. Observing => ",this.el),this.mutationObserver.observe(this.el,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["src"]}),this.perfObserver.observe({entryTypes:["resource"]})},z.prototype.stop=function(){this.logger("stop"),this.mutationObserver.disconnect(),this.perfObserver.disconnect()},z.prototype.initMutationObserver=function(){var e=this;this.mutationObserver=new MutationObserver((function(t){e.logger("mutation list => ",t);var i,n,o,s=(t=r((s=t,void 0===(i=e.config.selector)&&(i="img"),n=[],o=[],(s=void 0===t?[]:s).forEach((function(e){"childList"===e.type?(n.push.apply(n,a([],r(C(e.addedNodes,i)),!1)),o.push.apply(o,a([],r(C(e.removedNodes,i)),!1))):"attributes"===e.type&&(e=e.target)instanceof Element&&O(e)})),[n,o]),2))[0];t=t[1],e.logger("addedNodes => ",s,"\nremovedNodes => ",t),s.forEach((function(t){return e.imgMap.set(t,!0)})),t.forEach((function(t){return e.imgMap.delete(t)}))}))},z.prototype.getHeadersByFetch=function(e,t){return n(this,void 0,void 0,(function(){var i,n,r;return o(this,(function(o){switch(o.label){case 0:if(!(i=(null==t?void 0:t.currentSrc)||e.name))return this.logger("[Producer] cannot find uri from the img"),[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(i,{cache:"force-cache"})];case 2:return r=o.sent(),n=r.headers,[2,{status:r.status,headers:n}];case 3:return r=o.sent(),this.logger("[Producer] fetch failed: ",r),[2];case 4:return[2]}}))}))},z.prototype.getBasicInfo=function(e){var i,n,o=e.currentSrc;if(o)return i=e.naturalWidth||0,n=e.naturalHeight||0,(o={duration:0,uri:o}).applied_image_size="".concat(i,"*").concat(n),i=w(e.width)||e.style.width||null,n=w(e.height)||e.style.height||null,o.intended_image_size="".concat(i,"*").concat(n),t({},o);this.logger("[Producer] cannot find uri from the img")},z.prototype.send2Broker=function(e,t){return n(this,void 0,void 0,(function(){var i,n,r,a;return o(this,(function(o){switch(o.label){case 0:return(i=(null==t?void 0:t.currentSrc)||e.name)?(this.logger("send2broker task => ",i,e),r=(n=this.config.broker).receive,a={basicInfo:t?this.getBasicInfo(t):void 0},[4,this.getHeadersByFetch(e,t)]):[2];case 1:return r.apply(n,[(a.headers=o.sent(),a.resourceTiming=e,a)]),[2]}}))}))},z);function z(e){var t=this;if(this.initPerformanceObserver=function(){if("undefined"==typeof PerformanceObserver)throw new Error("[Producer] current browser does not support PerformanceObserver");t.perfObserver=new PerformanceObserver((function(e,i){PerformanceObserverEntryList&&e.constructor!==PerformanceObserverEntryList||(e=e.getEntries(),t.logger("entries => ",e),e.forEach((function(e){var i,n;if(!PerformanceResourceTiming||e.constructor===PerformanceResourceTiming){var o=(e=e.toJSON()).name,a=e.initiatorType;if("img"===a||"css"===a){var s=null;try{for(var c=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(t.imgMap),l=c.next();!l.done;l=c.next()){var h=r(l.value,1)[0];if(h.currentSrc===o){s=h;break}}}catch(e){i={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}s?(t.logger("corresponding img => ",s),t.send2Broker(e,s)):(t.logger("this entry doesn't exist in the monitor scope"),t.send2Broker(e))}}})))}))},this.logger=D("Producer"),this.config=Object.assign({},U,A(e)),!e.el)throw new Error("[Producer] you should provide el as the element to be observed");if("string"==typeof e.el){var i=document.querySelector(e.el);if(!i)throw new Error("[Producer] cannot find the element ".concat(e.el))}else i=e.el;this.el=i,this.logger("element to be observed => ",this.el),this.imgMap=new Map,this.initPerformanceObserver(),this.initMutationObserver()}function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var j=function(){return(j=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function K(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=r.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return a}(arguments[t]));return e}function q(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)}function H(e){if("string"==typeof e){for(var t=[],i=String.fromCharCode(122),n=e.split(i),o=0;o<n.length;o++){var r=64^+parseInt(n[o],25);r=String.fromCharCode(r),t.push(r)}return t.join("")}}function J(e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)}function W(){var e=0;return["hidden","msHidden","webkitHidden"].forEach((function(t){void 0!==document[t]&&(e=1)})),e}function F(e){var t=document.createElement("a");return t.href=e,t}function $(e){var t={};try{F(e).search.slice(1).split("&").forEach((function(e){var i,n,o=e.split("=");o.length&&(i=o[0],n=o[1]);try{t[i]=decodeURIComponent(void 0===n?"":n)}catch(e){t[i]=n}}))}catch(e){}return t}function X(e){for(var t=0,i=0,n=(e+="").length,o=0;o<n;o++)(0x7fffffffffff<(t=31*t+e.charCodeAt(i++))||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t}te.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},te.prototype.once=function(e,t){var i=this;e&&t&&"function"==typeof t&&this.on(e,(function n(o){t(o),i.off(e,n)}))},te.prototype.off=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&(t?-1!==(t=this._hooks[e].indexOf(t))&&this._hooks[e].splice(t,1):this._hooks[e]=[])},te.prototype.emit=function(e,t,i){i?e&&(-1!==this._cache.indexOf(i)?this._emit(e,t):(this._hooksCache.hasOwnProperty(i)||(this._hooksCache[i]={}),this._hooksCache[i].hasOwnProperty(e)||(this._hooksCache[i][e]=[]),this._hooksCache[i][e].push(t))):this._emit(e,t)},te.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&K(this._hooks[e]).forEach((function(e){try{e(t)}catch(e){}}))},te.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)};var Q,Y=te,Z=function(e){return Array.isArray(e)},ee=(Q=+Date.now()+Number((""+Math.random()).slice(2,8)),function(e,t,i){var n=document.createElement("script");n.src=e,n.onerror=function(){i(e)},n.onload=function(){t()},document.getElementsByTagName("head")[0].appendChild(n)});function te(){this._hooks={},this._cache=[],this._hooksCache={}}h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},function(e){function t(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)e[i]=n[i]}return e}e.exports=function e(i,n){function o(e,o,r){if("undefined"!=typeof document){"number"==typeof(r=t({},n,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a,s="";for(a in r)r[a]&&(s+="; "+a,!0!==r[a])&&(s+="="+r[a].split(";")[0]);return document.cookie=e+"="+i.write(o,e)+s}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],n={},o=0;o<t.length;o++){var r=t[o].split("="),a=r.slice(1).join("=");try{var s=decodeURIComponent(r[0]);if(n[s]=i.read(a,s),e===s)break}catch(e){}}return e?n[e]:n}},remove:function(e,i){o(e,"",t({},i,{expires:-1}))},withAttributes:function(i){return e(this.converter,t({},this.attributes,i))},withConverter:function(i){return e(t({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(i)}})}({read:function(e){return(e='"'===e[0]?e.slice(1,-1):e).replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}(u={exports:{}});var ie=u.exports,ne=(oe.prototype.setItem=function(e,t){this.cache[e]=t},oe.prototype.getItem=function(e){return this.cache[e]},oe.prototype.removeItem=function(e){this.cache[e]=void 0},oe.prototype.getCookie=function(e){this.getItem(e)},oe.prototype.setCookie=function(e,t){this.setItem(e,t)},oe);function oe(){this.cache={}}var re,ae={getItem:function(e){try{var t=localStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){try{return ie.get(e,{domain:t||document.domain})}catch(e){return""}},setCookie:function(e,t,i,n){try{var o=n||document.domain,r=+new Date+i;ie.set(e,t,{expires:new Date(r),path:"/",domain:o})}catch(e){}},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},se={getItem:function(e){try{var t=sessionStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e){this.getItem(e)},setCookie:function(e,t){this.setItem(e,t)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},ce=(ge.prototype.getItem=function(e){return this._storage.getItem(e)},ge.prototype.setItem=function(e,t){this._storage.setItem(e,t)},ge.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},ge.prototype.setCookie=function(e,t,i,n){this._storage.setCookie(e,t,i,n)},ge.prototype.removeItem=function(e){this._storage.removeItem(e)},ge),le=(de.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,i=document.referrer,n=i?F(i).hostname:"",o=$(window.location.href),r=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web",a=(this.utm=function(e,t,i,n){var o=new ce(!1),r=new ce(!1,"session"),a=e?"_tea_utm_cache_"+e:"_tea_utm_cache",s=e?"_$utm_from_url_"+e:"_$utm_from_url",c={},l=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],h={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var u,p,f=!1;for(u in h)h[u]&&(-1!==l.indexOf(u)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[u]=h[u]):c[u]=h[u],f=!0);f?(r.setItem(s,"1"),o.setCookie(a,JSON.stringify(c),n,i)):(p=o.getCookie(a,i))&&(c=JSON.parse(p)),r.getItem(s)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return h}return c}(this.appid,o,this.domain,this.cookie_expire),o=this.browser(),this.os());return{browser:o.browser,browser_version:o.browser_version,platform:r,os_name:a.os_name,os_version:a.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(a.os_name),language:t,referrer:i,referrer_host:n,utm:this.utm,latest_data:this.last(i,n)}},de.prototype.last=function(e,t){var i="",n="",o="",r=location.hostname,a=!1;return e&&t&&r!==t&&(n=t,a=!0,(r=$(i=e)).keyword)&&(o=r.keyword),{$latest_referrer:i,$latest_referrer_host:n,$latest_search_keyword:o,isLast:a}},de.prototype.browser=function(){var e,t="",i=""+parseFloat(this.appVersion),n=this.userAgent;return-1!==n.indexOf("Edge")||-1!==n.indexOf("Edg")?(t="Microsoft Edge",i=-1!==n.indexOf("Edge")?(e=n.indexOf("Edge"),n.substring(e+5)):(e=n.indexOf("Edg"),n.substring(e+4))):-1!==(e=n.indexOf("MSIE"))?(t="Microsoft Internet Explorer",i=n.substring(e+5)):-1!==(e=n.indexOf("Lark"))?(t="Lark",i=n.substring(e+5,e+11)):-1!==(e=n.indexOf("MetaSr"))?(t="sougoubrowser",i=n.substring(e+7,e+10)):-1!==n.indexOf("MQQBrowser")||-1!==n.indexOf("QQBrowser")?(t="qqbrowser",-1!==n.indexOf("MQQBrowser")?(e=n.indexOf("MQQBrowser"),i=n.substring(e+11,e+15)):-1!==n.indexOf("QQBrowser")&&(e=n.indexOf("QQBrowser"),i=n.substring(e+10,e+17))):-1!==n.indexOf("Chrome")?-1!==(e=n.indexOf("MicroMessenger"))?(t="weixin",i=n.substring(e+15,e+20)):-1!==(e=n.indexOf("360"))?(t="360browser",i=n.substring(n.indexOf("Chrome")+7)):-1!==n.indexOf("baidubrowser")||-1!==n.indexOf("BIDUBrowser")?(-1!==n.indexOf("baidubrowser")?(e=n.indexOf("baidubrowser"),i=n.substring(e+13,e+16)):-1!==n.indexOf("BIDUBrowser")&&(e=n.indexOf("BIDUBrowser"),i=n.substring(e+12,e+15)),t="baidubrowser"):-1!==(e=n.indexOf("xiaomi"))?i=-1!==n.indexOf("openlanguagexiaomi")?(t="openlanguage xiaomi",n.substring(e+7,e+13)):(t="xiaomi",n.substring(e-7,e-1)):-1!==(e=n.indexOf("TTWebView"))?(t="TTWebView",i=n.substring(e+10,e+23)):-1===(e=n.indexOf("Chrome"))&&-1===(e=n.indexOf("Chrome"))||(t="Chrome",i=n.substring(e+7)):-1!==n.indexOf("Safari")?-1!==(e=n.indexOf("QQ"))?(t="qqbrowser",i=n.substring(e+10,e+16)):-1!==(e=n.indexOf("Safari"))&&(t="Safari",i=n.substring(e+7),-1!==(e=n.indexOf("Version")))&&(i=n.substring(e+8)):-1!==(e=n.indexOf("Firefox"))?(t="Firefox",i=n.substring(e+8)):-1!==(e=n.indexOf("MicroMessenger"))?(t="weixin",i=n.substring(e+15,e+20)):-1!==(e=n.indexOf("QQ"))?(t="qqbrowser",i=n.substring(e+3,e+8)):-1!==(e=n.indexOf("Opera"))&&(t="Opera",i=n.substring(e+6),-1!==(e=n.indexOf("Version")))&&(i=n.substring(e+8)),{browser:t,browser_version:i=-1!==(n=(i=-1!==(n=(i=-1!==(n=i.indexOf(";"))?i.substring(0,n):i).indexOf(" "))?i.substring(0,n):i).indexOf(")"))?i.substring(0,n):i}},de.prototype.os=function(){for(var e="",t="",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<i.length;n++){var o=i[n];if(o.r.test(this.userAgent)){"Mac OS X"===(e=o.s)&&this.isNewIpad()&&(e="iOS");break}}function r(e,t){return(e=e.exec(t))&&e[1]?e[1]:""}function a(e,t){return(e=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t))?e.slice(1)[0]:""}var s;switch(/Windows/.test(e)&&(t=r(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=a("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":t=r(/Android ([\.\_\d]+)/,s=this.userAgent)||r(/Android\/([\.\_\d]+)/,s),e="android";break;case"iOS":t=this.isNewIpad()?a("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios"}return{os_name:e,os_version:t}},de.prototype.getDeviceModel=function(e){var t,i,n="";try{"android"===e?navigator.userAgent.split(";").forEach((function(e){-1<e.indexOf("Build/")&&(n=e.slice(0,e.indexOf("Build/")))})):"ios"!==e&&"mac"!==e&&"windows"!==e||(n=this.isNewIpad()?"iPad":(i=(t=navigator.userAgent.replace("Mozilla/5.0 (","")).indexOf(";"),t.slice(0,i)))}catch(e){}return n.trim()},de.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&1<navigator.maxTouchPoints},de),he={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az24z1mz1jz1az1cz18z1nz1nz1jz1mz1ez4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},ue={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},pe=(fe.prototype.checkVerify=function(e){var t,i,n,o=this;return!!(e&&e.length&&(e=e[0])&&(t=e.events,i=e.header,t)&&t.length)&&(n=!0,t.forEach((function(e){o.checkEventName(e.event)||(n=!1,e.checkEvent="事件名不能以 $ or __开头"),o.checkEventParams(e.params)||(n=!1,e.checkParams="属性名不能以 $ or __开头")})),n=!!this.checkEventParams(i)&&n)},fe.prototype.checkEventName=function(e){return!!e&&this.calculate(e,"event")},fe.prototype.checkEventParams=function(e){var t=e,i=("string"==typeof e&&(t=JSON.parse(t)),!0);if(Object.keys(t).length)for(var n in t){if(!this.calculate(n,"params")){i=!1;break}if("string"==typeof t[n]&&1024<t[n].length){console.warn("params: "+n+" can not over 1024 byte, please check;"),i=!1;break}}return i},fe.prototype.calculate=function(e,t){return-1!==("event"===t?this.eventNameWhiteList:"params"===t?this.paramsNameWhiteList:[]).indexOf(e)||!new RegExp("^\\$").test(e)&&!new RegExp("^__").test(e)||(console.warn(t+" name: "+e+" can not start with $ or __, pleace check;"),!1)},fe);function fe(e,t){this.collector=e,this.config=t,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","_be_active"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","$user_unique_id_type","_staging_flag"],this.regStr=new RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}function de(e,t,i){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=i}function ge(e,t){this._storage=t&&"session"===t?se:!e&&ae.isSupportLS?ae:new ne}(p=vt=vt||{}).Init="init",p.Config="config",p.Start="start",p.Ready="ready",p.TokenComplete="token-complete",p.TokenStorage="token-storage",p.TokenFetch="token-fetch",p.TokenError="token-error",p.ConfigUuid="config-uuid",p.ConfigWebId="config-webid",p.ConfigDomain="config-domain",p.CustomWebId="custom-webid",p.TokenChange="token-change",p.TokenReset="token-reset",p.ConfigTransform="config-transform",p.EnvTransform="env-transform",p.SessionReset="session-reset",p.SessionResetTime="session-reset-time",p.Event="event",p.Events="events",p.EventNow="event-now",p.CleanEvents="clean-events",p.BeconEvent="becon-event",p.SubmitBefore="submit-before",p.SubmitScuess="submit-scuess",p.SubmitAfter="submit-after",p.SubmitError="submit-error",p.SubmitVerify="submit-verify",p.SubmitVerifyH="submit-verify-h5",p.Stay="stay",p.ResetStay="reset-stay",p.StayReady="stay-ready",p.SetStay="set-stay",p.RouteChange="route-change",p.RouteReady="route-ready",p.Ab="ab",p.AbVar="ab-var",p.AbAllVars="ab-all-vars",p.AbConfig="ab-config",p.AbExternalVersion="ab-external-version",p.AbVersionChangeOn="ab-version-change-on",p.AbVersionChangeOff="ab-version-change-off",p.AbOpenLayer="ab-open-layer",p.AbCloseLayer="ab-close-layer",p.AbReady="ab-ready",p.AbComplete="ab-complete",p.AbTimeout="ab-timeout",p.Profile="profile",p.ProfileSet="profile-set",p.ProfileSetOnce="profile-set-once",p.ProfileUnset="profile-unset",p.ProfileIncrement="profile-increment",p.ProfileAppend="profile-append",p.ProfileClear="profile-clear",p.TrackDuration="track-duration",p.TrackDurationStart="track-duration-start",p.TrackDurationEnd="track-duration-end",p.TrackDurationPause="track-duration-pause",p.TrackDurationResume="tracl-duration-resume",p.Autotrack="autotrack",p.AutotrackReady="autotrack-ready",(f=re=re||{}).DEBUGGER_MESSAGE="debugger-message",f.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",f.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",f.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",f.DEBUGGER_MESSAGE_EVENT="debugger-message-event",f.DEVTOOL_WEB_READY="devtool-web-ready";var me=vt,_e=void 0,ve=(g=(new Date).getTimezoneOffset(),parseInt(""+-g/60,10)),ye=60*g,be=(De.prototype.initDomain=function(){var e=this.initConfig.channel_domain;e?this.domain=e:(e=this.initConfig.channel,this.domain=H(he[e]))},De.prototype.setDomain=function(e){this.domain=e},De.prototype.getDomain=function(){return this.domain},De.prototype.initABData=function(){var e,t="__tea_sdk_ab_version_"+this.initConfig.app_id,i=null;i=this.initConfig.ab_cross?(e=this.localStorage.getCookie(t,this.initConfig.ab_cookie_domain))?JSON.parse(e):null:this.localStorage.getItem(t),this.setAbCache(i)},De.prototype.setAbCache=function(e){this.ab_cache=e},De.prototype.getAbCache=function(){return this.ab_cache},De.prototype.setAbVersion=function(e){this.ab_version=e},De.prototype.getAbVersion=function(){return this.ab_version},De.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||"/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid"}return e="",this.initConfig.caller&&(e="?sdk_version=0.0.1&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+e},De.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data)this.envInfo.header.custom[t]=e.latest_data[t]},De.prototype.set=function(e){var t=this;Object.keys(e).forEach((function(i){void 0!==e[i]&&null!==e[i]||t.delete(i);try{t.eventCheck.calculate(i,"config")}catch(i){}var n,o,r;"traffic_type"===i&&t.isLast&&(t.envInfo.header.custom.$latest_traffic_source_type=e[i]),"evtParams"===i?t.evtParams=j({},t.evtParams||{},e.evtParams||{}):"_staging_flag"===i?t.evtParams=j({},t.evtParams||{},{_staging_flag:e._staging_flag}):"reportErrorCallback"===i&&"function"==typeof e[i]?t.reportErrorCallback=e[i]:(r=o="",-1<i.indexOf(".")&&(o=(n=i.split("."))[0],r=n[1]),o?"user"===o||"header"===o?t.envInfo[o][r]=e[i]:t.envInfo.header.custom[r]=e[i]:Object.hasOwnProperty.call(t.envInfo.user,i)?-1<["user_type","ip_addr_id"].indexOf(i)?t.envInfo.user[i]=e[i]&&Number(e[i]):-1<["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(i)?t.envInfo.user[i]=e[i]&&String(e[i]):-1<["user_is_auth","user_is_login"].indexOf(i)?t.envInfo.user[i]=Boolean(e[i]):"device_id"===i&&(t.envInfo.user[i]=e[i]):Object.hasOwnProperty.call(t.envInfo.header,i)?t.envInfo.header[i]=e[i]:t.envInfo.header.custom[i]=e[i])}))},De.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},De.prototype.setStore=function(e){try{var t,i;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.keys(e).length&&(i=Object.assign(e,t),this.storage.setItem(this.configKey,i))}catch(e){console.log("setStore error"),this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},De.prototype.getStore=function(){try{var e;return this.configPersist&&(e=this.storage.getItem(this.configKey)||{})&&Object.keys(e).length?e:null}catch(e){return this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),null}},De.prototype.delete=function(e){try{var t;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("delete error")}},De),Ee=(Ae.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[instance: "+this.name+"] "+e)},Ae.prototype.warn=function(e){this.isLog&&console.warn("%c %s","color: yellow; background-color: black;","[instance: "+this.name+"] "+e)},Ae.prototype.error=function(e){this.isLog&&console.error("[instance: "+this.name+"] "+e)},Ae.prototype.throw=function(e){throw this.error(this.name),new Error(e)},Ae),we=((m=Te.prototype).bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},m.bridgeReady=function(){var e=this;return new Promise((function(t,i){try{e.bridgeInject()?AppLogBridge.hasStarted((function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):i(!1)})):i(!1)}catch(e){console.log("AppLogBridge, error:"+JSON.stringify(e.stack)),i(!1)}}))},m.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(e){console.error("setNativeAppId error")}},m.setConfig=function(e){var t=this;try{Object.keys(e).forEach((function(i){"user_unique_id"===i?t.setUserUniqueId(e[i]):e[i]?t.addHeaderInfo(i,e[i]):t.removeHeaderInfo(i)}))}catch(e){console.error("setConfig error")}},m.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){console.error("setUserUniqueId error")}},m.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){console.error("addHeaderInfo error")}},m.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){console.error("setHeaderInfo error")}},m.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){console.error("removeHeaderInfo error")}},m.reportPv=function(e){this.onEventV3("predefine_pageview",e)},m.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t)}catch(e){console.error("onEventV3 error")}},m.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){console.error("profileSet error")}},m.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){console.error("profileSetOnce error")}},m.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){console.error("profileIncrement error")}},m.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){console.error("profileUnset error")}},m.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){console.error("profileAppend error")}},m.setExternalAbVersion=function(e){try{AppLogBridge.setExternalAbVersion(e)}catch(e){console.error("setExternalAbVersion error")}},m.getVar=function(e,t,i){try{"android"===this.os?i(AppLogBridge.getABTestConfigValueForKey(e,t)):AppLogBridge.getABTestConfigValueForKey(e,t,(function(e){i(e)}))}catch(e){console.error("getVar error"),i(t)}},m.getAllVars=function(e){try{"android"===this.os?e(AppLogBridge.getAllAbTestConfigs()):AppLogBridge.getAllAbTestConfigs((function(t){e(t)}))}catch(t){console.error("getAllVars error"),e(null)}},m.getAbSdkVersion=function(e){try{"android"===this.os?e(AppLogBridge.getAbSdkVersion()):AppLogBridge.getAbSdkVersion((function(t){e(t)}))}catch(t){console.error("getAbSdkVersion error"),e("")}},Te),Se=500,ke=5005;function Te(e,t){this.native=e.enable_native||e["evitaN".split("").reverse().join("")],this.os=t.get("os_name")}function Ae(e,t){this.isLog=t||!1,this.name=e||""}function De(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var i=new le(t.app_id,t.cookie_domain||"",t.cookie_expire||7776e6).init();this.eventCheck=new pe(e,t),e="__tea_cache_first_"+t.app_id,this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new ce(!1,"session"),this.localStorage=new ce(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage),(t=this.localStorage.getItem(e))&&1==t?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(e,"1")),this.envInfo={user:{user_unique_id:_e,user_type:_e,user_id:_e,user_is_auth:_e,user_is_login:_e,device_id:_e,web_id:_e,ip_addr_id:_e,user_unique_id_type:_e},header:{app_id:_e,app_name:_e,app_install_id:_e,install_id:_e,app_package:_e,app_channel:_e,app_version:_e,ab_version:_e,os_name:i.os_name,os_version:i.os_version,device_model:i.device_model,ab_client:_e,traffic_type:_e,client_ip:_e,device_brand:_e,os_api:_e,access:_e,language:i.language,region:_e,app_language:_e,app_region:_e,creative_id:i.utm.creative_id,ad_id:i.utm.ad_id,campaign_id:i.utm.campaign_id,log_type:_e,rnd:_e,platform:i.platform,sdk_version:"0.0.1",sdk_lib:"js",province:_e,city:_e,timezone:ve,tz_offset:ye,tz_name:_e,sim_region:_e,carrier:_e,resolution:i.screen_width+"x"+i.screen_height,browser:i.browser,browser_version:i.browser_version,referrer:i.referrer,referrer_host:i.referrer_host,width:i.screen_width,height:i.screen_height,screen_width:i.screen_width,screen_height:i.screen_height,utm_term:i.utm.utm_term,utm_content:i.utm.utm_content,utm_source:i.utm.utm_source,utm_medium:i.utm.utm_medium,utm_campaign:i.utm.utm_campaign,tracer_data:JSON.stringify(i.utm.tracer_data),custom:{},wechat_unionid:_e,wechat_openid:_e}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(i),this.initDomain(),this.initABData()}function Oe(e,t,i,n,o,r,a,s,c){try{var l=new XMLHttpRequest,h=s||"POST";l.open(h,""+e,!0),l.setRequestHeader("Content-Type","application/json; charset=utf-8"),a&&l.setRequestHeader("X-MCS-AppKey",""+a),n&&(l.withCredentials=!0),i&&(l.timeout=i,l.ontimeout=function(){r&&r(t,ke)}),l.onload=function(){if(o){var e=null;if(l.responseText){try{e=JSON.parse(l.responseText)}catch(t){e={}}o(e,t)}}},l.onerror=function(){l.abort(),r&&r(t,Se)},c?l.send(t):l.send(JSON.stringify(t))}catch(e){}}function Ce(e,t,i,n){try{var o=e.match(/\/v\d\//),r=o?o[0]:-1!==e.indexOf("/v1/")?"/v1/":"/v2/",a=e.split(r)[0];a?t.forEach((function(o){o=function(e){var t,i="";for(t in e)e.hasOwnProperty(t)&&void 0!==e[t]&&(i+="&"+t+"="+encodeURIComponent(JSON.stringify(e[t])));return"&"===i[0]?i.slice(1):i}(o);var r=new Image(1,1);r.onload=function(){r=null,i&&i()},r.onerror=function(){r=null,n&&n(e,t,Ve)},r.src=a+"/gif?"+o})):n(e,t,Ue)}catch(i){n&&n(e,t,ze,i.message)}}function Ie(e){return e?(e^16*Math.random()>>e/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,Ie)}function xe(){return Ie().replace(/-/g,"").slice(0,19)}function Me(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var Re,Ge,Pe,Be,Ne,Ue=4001,Ve=4e3,ze=4002,Le=(Qe.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new ce(!0),this.localStorage=new ce(!1),this.eventCheck=new pe(e,t),this.maxReport=t.max_report||20,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.collect.on(me.Ready,(function(){i.reportAll(!1)})),this.collect.on(me.ConfigDomain,(function(){i.reportUrl=i.configManager.getUrl("event")})),this.collect.on(me.Event,(function(e){i.event(e)})),this.collect.on(me.BeconEvent,(function(e){i.beconEvent(e)})),this.collect.on(me.CleanEvents,(function(){i.reportAll(!1)})),this.linster()},Qe.prototype.linster=function(){var e=this;window.addEventListener("unload",(function(){e.reportAll(!0)}),!1),J((function(){e.reportAll(!0)})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.reportAll(!0)}),!1)},Qe.prototype.reportAll=function(e){this.report(e),this.reportBecon()},Qe.prototype.event=function(e){var t=this;try{var i,n=K(e,this.cacheStorgae.getItem(this.eventKey)||[]);this.cacheStorgae.setItem(this.eventKey,n),this.reportTimeout&&clearTimeout(this.reportTimeout),n.length>=this.maxReport?this.report(!1):(i=this.reportTime,this.reportTimeout=setTimeout((function(){t.report(!1),t.reportTimeout=null}),i))}catch(e){this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},Qe.prototype.beconEvent=function(e){e=K(e,this.cacheStorgae.getItem(this.beconKey)||[]),this.cacheStorgae.setItem(this.beconKey,e),this.collect.destroyInstance||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},Qe.prototype.reportBecon=function(){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},Qe.prototype.report=function(e){var t;!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(t=this.cacheStorgae.getItem(this.eventKey)||[]).length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))},Qe.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var i=0;i<e.length;i+=this.eventLimit){var n=e.slice(i,i+this.eventLimit),o=this.split(this.merge(n));this.send(o,t)}else o=this.split(this.merge(e)),this.send(o,t)},Qe.prototype.merge=function(e,t){var i=this,n=(s=this.configManager.get()).header,o=s.user,r=(n.custom=JSON.stringify(n.custom),this.configManager.get("evtParams")),a=this.configManager.get("user_unique_id_type"),s=e.map((function(e){try{Object.keys(r).length&&!t&&(e.params=j({},r,e.params)),a&&(e.params.$user_unique_id_type=a);var n=i.configManager.getAbCache(),s=i.configManager.getAbVersion();return s&&n&&(i.config.disable_ab_reset||n.uuid===o.user_unique_id)&&(e.ab_sdk_version=s),e.session_id=i.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}catch(n){return i.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:n.message}),e}}));return e=[],Object.keys(o).length?((s=JSON.parse(JSON.stringify({events:s,user:o,header:n}))).local_time=Math.floor(Date.now()/1e3),s.verbose=1,s.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,e.push(s)):console.warn("user info error，cant report"),e},Qe.prototype.split=function(e){return e.map((function(e){var t=[];return t.push(e),t}))},Qe.prototype.send=function(e,t){var i=this;e.length&&e.forEach((function(e){try{var n=JSON.parse(JSON.stringify(e)),o=(i.config.filter&&!(n=i.config.filter(n))&&console.warn("filter must return data !!"),i.collect.eventFilter&&n&&((n=i.collect.eventFilter(n))||console.warn("filterEvent api must return data !!")),n||e),r=JSON.parse(JSON.stringify(o));i.eventCheck.checkVerify(r),o.length&&(i.collect.emit(me.SubmitBefore,o),i.collect.emit(me.SubmitVerify,o),function(e,t,i,n,o,r,a,s){var c=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===c.indexOf("MSIE 8.0")&&-1===c.indexOf("MSIE 9.0")){if(a)return window.navigator&&window.navigator.sendBeacon?window.navigator.sendBeacon(e,JSON.stringify(t))?o():r(e,t,4003):Ce(e,t,o,r)}else Ce(e,t,o,r);Oe(e,t,i,n,o,r,"","",s)}(i.reportUrl,o,i.timeout,!1,(function(e,t){e&&0!==e.e?(i.collect.emit(me.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),i.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_EVENT,info:"埋点上报失败",time:Date.now(),data:r,code:e.e,failType:"数据异常",status:"fail"})):(i.collect.emit(me.SubmitScuess,{eventData:t,res:e}),i.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:r,code:200,status:"success"}))}),(function(e,t){i.configManager.get("reportErrorCallback")(e,t),i.collect.emit(me.SubmitError,{type:"f_net",eventData:e,errorCode:t}),i.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_EVENT,info:"埋点上报网络异常",time:Date.now(),data:r,code:t,failType:"网络异常",status:"fail"})}),t,!1),i.eventCheck.checkVerify(o),i.collect.emit(me.SubmitVerify,o),i.collect.emit(me.SubmitVerifyH,o),i.collect.emit(me.SubmitAfter,o))}catch(e){console.warn("something error, "+JSON.stringify(e.stack)),i.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}}))},Qe),je=(Xe.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new ce(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(me.ConfigUuid,(function(e){i.setUuid(e)})),this.collect.on(me.ConfigWebId,(function(e){i.setWebId(e)})),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},Xe.prototype.checkStorage=function(){var e,t=this;this.enableCookie?(e=this.storage.getCookie(this.tokenKey,this.cookieDomain),this.cacheToken=e&&"string"==typeof e?JSON.parse(e):{}):this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(me.CustomWebId,(function(){t.tokenReady=!0,t.collect.emit(me.TokenComplete)})):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},Xe.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:xe(),user_unique_id:this.configManager.get("user_unique_id")||xe()}):this.remoteWebid()},Xe.prototype.checkEnv=function(){var e=window.navigator.userAgent;return(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram"))&&!(!(e=$(window.location.href))||!e.Web_ID||(this.complete({web_id:""+e.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+e.Web_ID}),0))},Xe.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),i={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""},n=(this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 发起WEBID请求",logType:"fetch",level:"info",time:Date.now(),data:i}),xe());Oe(t,i,3e5,!1,(function(t){var i;t&&0===t.e?(i=t.web_id,e.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"WEBID请求成功",logType:"fetch",level:"info",time:Date.now(),data:t})):(e.collect.configManager.set({localWebId:i=n}),e.collect.emit(me.TokenError),e.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"WEBID请求返回值异常",logType:"fetch",level:"warn",time:Date.now(),data:t}),e.collect.logger.warn("appid: "+e.config.app_id+" get webid error, use local webid~")),e.complete({web_id:e.configManager.get("web_id")||i,user_unique_id:e.configManager.get("user_unique_id")||i})}),(function(){e.complete({web_id:e.configManager.get("web_id")||n,user_unique_id:e.configManager.get("user_unique_id")||n}),e.collect.configManager.set({localWebId:n}),e.collect.emit(me.TokenError),e.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"WEBID请求网络异常",logType:"fetch",level:"error",time:Date.now(),data:null}),e.collect.logger.warn("appid: "+e.config.app_id+", get webid error, use local webid~")}))},Xe.prototype.complete=function(e){var t=e.web_id,i=e.user_unique_id;t||i?(e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:i}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(me.TokenComplete)):(this.collect.emit(me.TokenError),console.warn("token error"))},Xe.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",i=this.configManager.get("user_unique_id");this.configManager.set({user_unique_id:i||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(me.TokenComplete)},Xe.prototype.setUuid=function(e){var t,i;e&&-1===["null","undefined","Null","None"].indexOf(e)?(e=String(e),t=this.configManager.get("user_unique_id"),i=this.cacheToken&&this.cacheToken.user_unique_id,e===t&&e===i||(this.configManager.set({user_unique_id:e}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(me.TokenChange,"uuid"),this.collect.emit(me.SessionReset))):this.clearUuid()},Xe.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(me.TokenReset))},Xe.prototype.setWebId=function(e){var t,i;e&&!this.config.enable_ttwebid&&(this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now(),t=this.configManager.get("web_id"),(i=this.configManager.get("user_unique_id"))&&i!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(me.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(me.TokenChange,"webid")),this.setStorage(this.cacheToken))},Xe.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},Xe.prototype.getReady=function(){return this.tokenReady},Xe.prototype.getTobId=function(){var e=this,t=this.configManager.getUrl("tobid");return new Promise((function(i){Oe(t,{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},3e4,e.enable_ttwebid,(function(e){e&&0===e.e?i(e.tobid):i("")}),(function(){i("")}))}))},Xe),Ke=($e.prototype.apply=function(e,t){var i=this;this.collect=e,this.storage=new ce(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(me.SessionReset,(function(){i.resetSessionId()})),this.collect.on(me.SessionResetTime,(function(){i.updateSessionIdTime()})))},$e.prototype.updateSessionIdTime=function(){var e,t=this.storage.getItem(this.sessionKey);t&&t.sessionId&&(e=t.timestamp,Date.now()-e>this.expireTime?t={sessionId:Me(),timestamp:Date.now()}:t.timestamp=Date.now(),this.storage.setItem(this.sessionKey,t),this.resetExpTime())},$e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:Me(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime)},$e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return!this.disableSession&&e&&e.sessionId?e.sessionId:""},$e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))},$e.prototype.resetSessionId=function(){var e={sessionId:Me(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},$e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:Me(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},$e),qe=(Fe.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(e){console.log("devTool load fail, "+e.message)}},Fe.prototype.load=function(){try{this.loadBaseInfo(),this.loadHook();var e=$(window.location.href);e.open_devtool_web&&parseInt(e.app_id)===this.app_id&&(this.addLintener(),this.loadDebuggerModule(),this.loadDevTool())}catch(e){console.log("debug fail, "+e.message)}},Fe.prototype.loadDevTool=function(){this.loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.js")},Fe.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"基本信息",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,"上报域名":this.collect.configManager.getDomain(),"SDK版本":"0.0.1","SDK引入方式":"npm"}},{title:"用户信息",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"点击获取SSID"}},{title:"公共参数信息",type:2,infoName:{"浏览器":this.collect.configManager.get("browser"),"浏览器版本":this.collect.configManager.get("browser_version"),"平台":this.collect.configManager.get("platform"),"设备型号":this.collect.configManager.get("device_model"),"操作系统":this.collect.configManager.get("os_name"),"操作系统版本":this.collect.configManager.get("os_version"),"屏幕分辨率":this.collect.configManager.get("os_version"),"来源":this.collect.configManager.get("referrer"),"自定义信息":""}},{title:"配置信息",type:3,infoName:{"全埋点":!!this.config.autotrack,"停留时长":!!this.config.enable_stay_duration}},{title:"A/B配置信息",type:4,infoName:{"A/B实验":!!this.config.enable_ab_test}},{title:"客户端信息",type:3,infoName:{"打通开关":!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(me.Ready,(function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["自定义信息"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["已曝光VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B域名"]=e.config.ab_channel_domain||H(ue[e.config.channel]),e.info[4].infoName["全部配置"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["是否打通"]=!!e.collect.bridgeReport)}))},Fe.prototype.loadHook=function(){var e=this;this.collect.on(re.DEBUGGER_MESSAGE,(function(t){switch(t.type){case re.DEBUGGER_MESSAGE_SDK:var i={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(i.desc={content:JSON.stringify(t.data)}),e.updateLog(i),t.secType&&"AB"===t.secType?(e.info[4].infoName["已曝光VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["全部配置"]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case re.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var n=(i=t.data[0]).events;if(!n.length)return;n.forEach((function(i){i.checkShow=!0,i.searchShow=!0,i.success=t.status,i.type=-1!==e.filterEvent.indexOf(i.event)?"sdk":"cus",i.type=e.collect.bridgeReport?"bridge":i.type,i.info="","fail"===t.status&&(i.info={message:"code: "+t.code+"， msg: "+t.failType})})),e.updateEvent(i)}return}}))},Fe.prototype.addLintener=function(){var e=this;window.addEventListener("message",(function(t){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;console.log("inittttt"),e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken((function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()}))}))},Fe.prototype.sendData=function(e,t){try{var i={type:e,payload:t};(window.opener||window.parent).postMessage(i,this.devToolOrigin)}catch(e){}},Fe.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},Fe.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},Fe.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},Fe.prototype.loadDebuggerModule=function(){var e,t=document.head||document.getElementsByTagName("head")[0];(e=document.createElement("style")).appendChild(document.createTextNode("#debugger-applog-web {\n      position: fixed;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),t.appendChild(e),((t=document.createElement("div")).innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLog调试</div>',e=document.createElement("div")).innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(t),document.getElementsByTagName("body")[0].appendChild(e),document.getElementById("debugger-applog-web").addEventListener("click",(function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)}))},Fe),He=(We.usePlugin=function(e,t,i){if(t){for(var n=!1,o=0,r=We.plugins.length;o<r;o++)if(We.plugins[o].name===t){We.plugins[o].plugin=e,We.plugins[o].options=i||{},n=!0;break}n||We.plugins.push({name:t,plugin:e,options:i})}else We.plugins.push({plugin:e})},We.prototype.init=function(e){var t,i=this;this.inited?console.log("init can be call only one time"):e&&q(e)?e.app_id&&"number"==typeof(t=e.app_id)&&!isNaN(t)?e.app_key&&"string"!=typeof e.app_key?console.warn("app_key param is error, must be string, please check!"):(e.channel_domain||-1!==["cn","sg","va"].indexOf(e.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),e.channel="cn"),this.inited=!0,this.logger=new Ee(this.name,e.log),this.configManager=new be(this,e),this.appBridge=new we(e,this.configManager),this.bridgeReport=this.appBridge.bridgeInject(),this.debugger=new qe(this,e),this.initConfig=e,this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行INIT",data:e,level:"info",time:Date.now()}),e.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:e.app_id}),this.eventManager=new Le,this.tokenManager=new je,this.sessionManager=new Ke,Promise.all([new Promise((function(e){i.once(me.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){i.once(me.Start,(function(){e(!0)}))}))]).then((function(){try{We.plugins.reduce((function(e,t){var n=t.plugin;return t=t.options,t=Object.assign(i.initConfig,t),(n=new n).apply(i,t),e.push(n),e}),i.pluginInstances)}catch(e){console.log("load plugin error, "+e.message),i.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}i.sdkReady=!0,i.emit(me.Ready),i.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 初始化完成",time:Date.now(),level:"info",data:i.configManager.get("user")}),i.logger.info("appid: "+e.app_id+", userInfo:"+JSON.stringify(i.configManager.get("user"))),i.logger.info("appid: "+e.app_id+", sdk is ready, version is 0.0.1, you can report now !!!");try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){i.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}i.pageView(),i.on(me.TokenChange,(function(t){"webid"===t&&i.pageView(),i.logger.info("appid: "+e.app_id+" token change, new userInfo:"+JSON.stringify(i.configManager.get("user"))),i.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 设置了用户信息",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})})),i.on(me.TokenReset,(function(){i.logger.info("appid: "+e.app_id+" token reset, new userInfo:"+JSON.stringify(i.configManager.get("user"))),i.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 重置了用户信息",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})})),i.on(me.RouteChange,(function(t){t.init||e.disable_route_report||i.pageView()}))})),this.tokenManager.apply(this,e),this.eventManager.apply(this,e),this.sessionManager.apply(this,e),this.emit(me.Init))):console.warn("app_id param is error, must be number, please check!"):console.warn("init params error,please check")},We.prototype.config=function(e){var t,i;this.inited?e&&q(e)?this.bridgeReport?this.appBridge.setConfig(e):(e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv),t=j({},e),this.initConfig&&this.initConfig.configPersist&&((i=this.configManager.getStore())&&(t=Object.assign(i,e)),this.configManager.setStore(e)),t.web_id,t.user_unique_id,i=function(e,t){var i={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(i[o[n]]=e[o[n]]);return i}(t,["web_id","user_unique_id"]),t.hasOwnProperty("web_id")&&this.emit(me.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(me.ConfigUuid,t.user_unique_id),this.configManager.set(i),this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行CONFIG",level:"info",time:Date.now(),data:t})):this.logger.warn("config params is error, please check"):this.logger.warn("config must be use after function init")},We.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(me.ConfigDomain)},We.prototype.getConfig=function(e){return this.configManager.get(e)},We.prototype.send=function(){this.start()},We.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(me.Start),this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行START",level:"info",time:Date.now()}),this.bridgeReport)&&(this.pageView(),this.emit(me.Ready))},We.prototype.event=function(e,t){var i,n=this;try{this.initConfig&&this.initConfig.disable_track_event||(i=[],Array.isArray(e)?e.forEach((function(e){i.push(n.processEvent(e[0],e[1]||{}))})):i.push(this.processEvent(e,t)),this.bridgeReport?i.forEach((function(e){var t=e.event;e=e.params,n.appBridge.onEventV3(t,JSON.stringify(e))})):i.length&&(this.emit(me.Event,i),this.emit(me.SessionResetTime)))}catch(e){this.logger.warn("something error, please check"),this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},We.prototype.beconEvent=function(e,t){var i;this.initConfig&&this.initConfig.disable_track_event||(Array.isArray(e)?console.warn("beconEvent not support batch report, please check"):((i=[]).push(this.processEvent(e,t||{})),i.length&&(this.emit(me.BeconEvent,i),this.emit(me.SessionResetTime))))},We.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var i=e,n=(/^event\./.test(e)&&(i=e.slice(6)),t),o=void((n="object"!=L(n)?{}:n).profile?delete n.profile:n.event_index=Q+=1);return n.local_ms?(o=n.local_ms,delete n.local_ms):o=+new Date,{event:i,params:n,local_time_ms:o,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(i){return this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message}),{event:e,params:t}}},We.prototype.filterEvent=function(e){this.eventFilter=e},We.prototype.on=function(e,t){this.hook.on(e,t)},We.prototype.once=function(e,t){this.hook.once(e,t)},We.prototype.off=function(e,t){this.hook.off(e,t)},We.prototype.emit=function(e,t,i){this.hook.emit(e,t,i)},We.prototype.set=function(e){this.hook.set(e)},We.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},We.prototype.predefinePageView=function(e){void 0===e&&(e={});var t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+this.configManager.is_first_time};t=j({},t,e),this.event("predefine_pageview",t)},We.prototype.clearEventCache=function(){this.emit(me.CleanEvents)},We.prototype.setWebIDviaUnionID=function(e){var t;e&&(t=X(e),this.config({web_id:""+t,wechat_unionid:e}),this.emit(me.CustomWebId))},We.prototype.setWebIDviaOpenID=function(e){var t;e&&(t=X(e),this.config({web_id:""+t,wechat_openid:e}),this.emit(me.CustomWebId))},We.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},We.prototype.resetStayDuration=function(e,t,i){this.emit(me.ResetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:i=void 0===i?"":i},me.Stay)},We.prototype.resetStayParams=function(e,t,i){this.emit(me.SetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:i=void 0===i?"":i},me.Stay)},We.prototype.getToken=function(e,t){function i(t){var i;r||(r=!0,i=o.configManager.get().user,t&&(i.tobid=t,i["diss".split("").reverse().join("")]=t),e(j({},i)))}function n(){o.tokenManager.getTobId().then((function(e){i(e)}))}var o=this,r=!1;this.sdkReady?n():(t&&setTimeout((function(){i()}),t),this.on(me.Ready,(function(){n()})))},We.prototype.startTrackEvent=function(e){e&&this.emit(me.TrackDurationStart,e,me.TrackDuration)},We.prototype.endTrackEvent=function(e,t){void 0===t&&(t={}),e&&this.emit(me.TrackDurationEnd,{eventName:e,params:t},me.TrackDuration)},We.prototype.pauseTrackEvent=function(e){e&&this.emit(me.TrackDurationPause,e,me.TrackDuration)},We.prototype.resumeTrackEvent=function(e){e&&this.emit(me.TrackDurationResume,e,me.TrackDuration)},We.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(me.ProfileSet,e,me.Profile),this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSet",level:"info",time:Date.now(),data:e})},We.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(me.ProfileSetOnce,e,me.Profile),this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSetOnce",level:"info",time:Date.now(),data:e})},We.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(me.ProfileIncrement,e,me.Profile),this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileIncrement",level:"info",time:Date.now(),data:e})},We.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(me.ProfileUnset,e,me.Profile),this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileUnset",level:"info",time:Date.now(),data:e})},We.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(me.ProfileAppend,e,me.Profile),this.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileAppend",level:"info",time:Date.now(),data:e})},We.prototype.setExternalAbVersion=function(e){this.bridgeReport?this.appBridge.setExternalAbVersion(e):this.emit(me.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,me.Ab)},We.prototype.getVar=function(e,t,i){this.bridgeReport?this.appBridge.getVar(e,t,i):this.emit(me.AbVar,{name:e,defaultValue:t,callback:i},me.Ab)},We.prototype.getAllVars=function(e){this.bridgeReport?this.appBridge.getAllVars(e):this.emit(me.AbAllVars,e,me.Ab)},We.prototype.getABconfig=function(e,t){this.emit(me.AbConfig,{params:e,callback:t},me.Ab)},We.prototype.getAbSdkVersion=function(e){if(!this.bridgeReport||!e)return this.configManager.getAbVersion()||"";this.appBridge.getAbSdkVersion(e)},We.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(me.AbVersionChangeOn,e,me.Ab),function(){t.emit(me.AbVersionChangeOff,e,me.Ab)}},We.prototype.offAbSdkVersionChange=function(e){this.emit(me.AbVersionChangeOff,e,me.Ab)},We.prototype.openOverlayer=function(){this.emit(me.AbOpenLayer,"",me.Ab)},We.prototype.closeOverlayer=function(){this.emit(me.AbCloseLayer,"",me.Ab)},We.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(me.TokenComplete))},We.plugins=[],We),Je="__rangers_ab_style__";function We(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.adapters={},this.sdkReady=!1,this.name=e,this.hook=new Y,this.logger=new Ee(e),this.remotePlugin=new Map,this.Types=me,this.adapters.fetch=Oe,this.adapters.storage=ce}function Fe(e,t){this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.collect=e,this.config=t,this.app_id=t.app_id,this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}function $e(){}function Xe(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}function Qe(){this.eventLimit=50,this.eventCache=[],this.beconEventCache=[]}Pe=h,Be=function(){try{return!!Symbol.iterator}catch(e){return!1}}(),function(){try{var e=Pe.URLSearchParams;return"a=1"===new e("?a=1").toString()&&"function"==typeof e.prototype.set&&"function"==typeof e.prototype.entries}catch(e){}}()||((Ne=ot.prototype).append=function(e,t){e in this._entries?this._entries[e].push(String(t)):this._entries[e]=[String(t)]},Ne.delete=function(e){delete this._entries[e]},Ne.get=function(e){return e in this._entries?this._entries[e][0]:null},Ne.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[]},Ne.has=function(e){return e in this._entries},Ne.set=function(e,t){this._entries[e]=[String(t)]},Ne.forEach=function(e,t){for(var i in this._entries)if(this._entries.hasOwnProperty(i))for(var n=this._entries[i],o=0;o<n.length;o++)e.call(t,n[o],i,this)},Ne.keys=function(){var e=[];return this.forEach((function(t,i){e.push(i)})),tt(e)},Ne.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),tt(e)},Ne.entries=function(){var e=[];return this.forEach((function(t,i){e.push([i,t])})),tt(e)},Be&&(Ne[Symbol.iterator]=Ne.entries),Ne.toString=function(){var e=[];return this.forEach((function(t,i){e.push(it(i)+"="+it(t))})),e.join("&")},Pe.URLSearchParams=ot),"function"!=typeof(Ne=Pe.URLSearchParams.prototype).sort&&(Ne.sort=function(){var e=this,t=[];this.forEach((function(i,n){t.push([n,i]),e._entries||e.delete(n)})),t.sort((function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0})),e._entries&&(e._entries={});for(var i=0;i<t.length;i++)this.append(t[i][0],t[i][1])}),"function"!=typeof Ne._fromString&&Object.defineProperty(Ne,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(e){if(this._entries)this._entries={};else{var t=[];this.forEach((function(e,i){t.push(i)}));for(var i=0;i<t.length;i++)this.delete(t[i])}var n,o=(e=e.replace(/^\?/,"")).split("&");for(i=0;i<o.length;i++)n=o[i].split("="),this.append(nt(n[0]),1<n.length?nt(n[1]):"")}});var Ye=h;if(function(){try{var e=new Ye.URL("b","http://a");return e.pathname="c d","http://a/c%20d"===e.href&&e.searchParams}catch(e){}}()||(Re=Ye.URL,Ge=et.prototype,["hash","host","hostname","port","protocol"].forEach((function(e){var t;t=e,Object.defineProperty(Ge,t,{get:function(){return this._anchorElement[t]},set:function(e){this._anchorElement[t]=e},enumerable:!0})})),Object.defineProperty(Ge,"search",{get:function(){return this._anchorElement.search},set:function(e){this._anchorElement.search=e,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(Ge,{toString:{get:function(){var e=this;return function(){return e.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(e){this._anchorElement.href=e,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(e){this._anchorElement.pathname=e},enumerable:!0},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol];return e=this._anchorElement.port!=e&&""!==this._anchorElement.port,this._anchorElement.protocol+"//"+this._anchorElement.hostname+(e?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(e){},enumerable:!0},username:{get:function(){return""},set:function(e){},enumerable:!0}}),et.createObjectURL=function(e){return Re.createObjectURL.apply(Re,arguments)},et.revokeObjectURL=function(e){return Re.revokeObjectURL.apply(Re,arguments)},Ye.URL=et),void 0!==Ye.location&&!("origin"in Ye.location)){var Ze=function(){return Ye.location.protocol+"//"+Ye.location.hostname+(Ye.location.port?":"+Ye.location.port:"")};try{Object.defineProperty(Ye.location,"origin",{get:Ze,enumerable:!0})}catch(l){setInterval((function(){Ye.location.origin=Ze()}),100)}}function et(e,t){"string"!=typeof e&&(e=String(e)),t&&"string"!=typeof t&&(t=String(t));var i=document;if(t&&(void 0===Ye.location||t!==Ye.location.href)){t=t.toLowerCase(),(o=(i=document.implementation.createHTMLDocument("")).createElement("base")).href=t,i.head.appendChild(o);try{if(0!==o.href.indexOf(t))throw new Error(o.href)}catch(e){throw new Error("URL unable to set base "+t+" due to "+e)}}var n=i.createElement("a"),o=(n.href=e,o&&(i.body.appendChild(n),n.href=n.href),i.createElement("input"));if(o.type="url",o.value=e,":"===n.protocol||!/:/.test(n.href)||!o.checkValidity()&&!t)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:n});var r=new Ye.URLSearchParams(this.search),a=!0,s=!0,c=this,l=(["append","delete","set"].forEach((function(e){var t=r[e];r[e]=function(){t.apply(r,arguments),a&&(s=!1,c.search=r.toString(),s=!0)}})),void Object.defineProperty(this,"searchParams",{value:r,enumerable:!0}));Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==l&&(l=this.search,s)&&(a=!1,this.searchParams._fromString(this.search),a=!0)}})}function tt(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return Be&&(t[Symbol.iterator]=function(){return t}),t}function it(e){return encodeURIComponent(e).replace(/%20/g,"+")}function nt(e){return decodeURIComponent(String(e).replace(/\+/g," "))}function ot(e){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var t=L(e);if("undefined"!==t)if("string"===t)""!==e&&this._fromString(e);else if(e instanceof ot){var i=this;e.forEach((function(e,t){i.append(t,e)}))}else{if(null===e||"object"!==t)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(e))for(var n=0;n<e.length;n++){var o=e[n];if("[object Array]"!==Object.prototype.toString.call(o)&&2===o.length)throw new TypeError("Expected [string, any] as entry at index "+n+" of URLSearchParams's input");this.append(o[0],o[1])}else for(var r in e)e.hasOwnProperty(r)&&this.append(r,e[r])}}function rt(e){e.length&&e.forEach((function(e){st.push(e)}))}var at={},st=[];function ct(e,t,i,n){var o=e&&e.source||window.opener||window.parent;e=e&&e.origin||n||"*",o.postMessage(JSON.stringify({type:t,payload:i}),e)}function lt(e,t){at[e]=at[e]||[],at[e].push(t)}function ht(e){if(st.some((function(e){return"*"===e}))||st.some((function(t){return-1<e.origin.indexOf(t)}))){var t,i,n=e.data;if("string"==typeof e.data)try{n=JSON.parse(e.data)}catch(e){n=void 0}n&&(t=n.type,i=n.payload,at[t])&&at[t].forEach((function(t){"function"==typeof t&&t(e,i)}))}}function ut(e,t){(e=j({},e)).filter&&delete e.filter,"object"==L(e.autotrack)&&e.autotrack.collect_url&&delete e.autotrack.collect_url,(window.opener||window.parent).postMessage({type:"tea:sdk:info",config:e,version:t},"*"),window.addEventListener("message",ht,!1)}var pt,ft,dt=!1;function gt(e){var t=e.event,i=e.editorUrl;e.collectInstance,e.fromSession,dt||(dt=!0,ee(i,(function(){ct(t,"abEditorScriptloadSuccess")}),(function(){t&&ct(t,"abEditorScriptloadError"),dt=!1})))}(l=ft=ft||{})[l.Var=0]="Var",l[l.All=1]="All",Tt.prototype.apply=function(e,t){var i,n,o,r,a,s,c,l,h=this;this.collect=e,this.config=t,this.config.enable_ab_test&&(i=t.enable_multilink,s=t.ab_channel_domain,n=t.enable_ab_visual,o=t.ab_cross,r=t.ab_cookie_domain,a=t.disable_ab_reset,s=s||H(ue[t.channel||"cn"]),l=(c=e.adapters).storage,c=c.fetch,this.cacheStorgae=new l(!1),this.fetch=c,this.enable_multilink=i,this.enable_ab_visual=n,this.abKey="__tea_sdk_ab_version_"+t.app_id,this.ab_cross=o,this.ab_cookie_domain=r||"",this.fetchUrl=s+"/service/2/abtest_config/",this.reportUrl=""+e.configManager.getUrl("event"),this.exposureLimit=t.exposure_limit||20,this.ab_batch_time=t.ab_batch_time||500,l=this.collect.Types,this.types=l,this.collect.on(l.TokenChange,(function(e){a||"uuid"===e&&h.readyStatus&&(h.clearCache(),h.fetchAB())})),this.collect.on(l.AbVar,(function(e){var t=e.name,i=e.defaultValue;e=e.callback,h.getVar(t,i,e)})),this.collect.on(l.AbAllVars,(function(e){h.getAllVars(e)})),this.collect.on(l.AbConfig,(function(e){var t=e.params;e=e.callback,h.getABconfig(t,e)})),this.collect.on(l.AbExternalVersion,(function(e){h.setExternalAbVersion(e)})),this.collect.on(l.AbOpenLayer,(function(){h.openOverlayer()})),this.collect.on(l.AbCloseLayer,(function(){h.closeOverlayer()})),this.collect.on(l.AbVersionChangeOn,(function(e){h.changeListener.set(e,e)})),this.collect.on(l.AbVersionChangeOff,(function(e){h.changeListener.get(e)&&h.changeListener.delete(e)})),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(l.AbReady))},Tt.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(Object.keys(i).length)for(var n in i)!function(e){i[e].length&&i[e].forEach((function(i){t.collect.hook.emit(e,i)}))}(n)}},Tt.prototype.loadMode=function(){var e,t,i=function(){try{return JSON.parse(atob(window.name))||void 0}catch(e){}}(),n="";i&&(t=i.scenario,i=i.href,t?(this.editMode=!0,n=t):!i||-1===i.indexOf("datatester")&&-1===i.indexOf("visual-editor")||(this.editMode=!0,n="visual-editor")),this.enable_ab_visual&&(function(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{},rt(["*"]);var i,n="",o=(ut(t,"0.0.1"),"");try{var r=window.performance.getEntriesByType("resource");if(r&&r.length&&(r.forEach((function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(o=e.name)})),o||document.currentScript&&(o=document.currentScript.src),o)&&(i=o.split("/"))&&i.length){n="https:/";for(var a=2;a<i.length&&a!==i.length-1;a++)n=n+"/"+i[a];n+="/visual-ab-core"}}catch(e){}lt("tea:openVisualABEditor",(function(i){var o,r=i.data;if("string"==typeof i.data)try{r=JSON.parse(i.data)}catch(i){r=void 0}r&&(o=r.lang,r.appId!==t.app_id?(ct(i,"appIdError"),console.error("abtest appid is not belong the page appid please check")):(r=r.version,pt=r&&n?n+(r?"."+r:".1.0.1")+".js?query="+Date.now():"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-core.js?query="+Date.now(),window.TEAVisualEditor.lang=o,window.TEAVisualEditor.__ab_domin=t.channel_domain||"",gt({event:i,editorUrl:pt,collectInstance:e})))}))}(this.collect,this.config),"visual-editor"===n)?this.collect.destoryInstace():this.enable_multilink&&(e=this.collect,t=this.config,window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=t.app_id,lt("tea:openTesterEventInspector",(function(t){var i,n,o=t.data;if("string"==typeof t.data)try{o=JSON.parse(t.data)}catch(t){o=void 0}o&&(i=o.referrer,n=o.lang,o=o.appId,window.TEAVisualEditor.__editor_ajax_domain=i||"",window.TEAVisualEditor.__ab_appId=o||"",window.TEAVisualEditor.lang=n||"",gt({event:t,editorUrl:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector.js?query="+Date.now(),collectInstance:e}))})))},Tt.prototype.checkLocal=function(){var e=(n=this.getABCache()).ab_version,t=n.ab_ext_version,i=n.ab_version_multilink,n=n.data,o=((o=this.checkFromUrl())?this.mulilinkVersions.push(o):this.mulilinkVersions=i||[],this.extVersions=t||[],this.versions=e||[],this.data=n,this.versions.concat(this.extVersions));this.enable_multilink&&(o=o.concat(this.mulilinkVersions)),this.configVersions(o.join(","))},Tt.prototype.checkFromUrl=function(){var e=$(window.location.href);return e&&e.vid?e.vid:""},Tt.prototype.updateVersions=function(){var e=this.extVersions.length?this.versions.concat(this.extVersions):this.versions;this.enable_multilink&&(e=e.concat(this.mulilinkVersions)),this.configVersions(e.join(",")),this.updateABCache(),0<this.changeListener.size&&this.changeListener.forEach((function(t){"function"==typeof t&&t(e)}))},Tt.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},Tt.prototype.getVar=function(e,t,i){if(!e)throw new Error("variable must not be empty");if(void 0===t)throw new Error("variable no default value");if("function"!=typeof i)throw new Error("callback must be a function");t={name:e,defaultValue:t,callback:i,type:ft.Var},"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(t,e):this.callbacks.push(t)},Tt.prototype.getRealVar=function(e,t){var i,n=e.name,o=e.defaultValue,r=(e=e.callback,this.data);r?q(r[n])?(i=r[n].vid,"$ab_url"===t?this.mulilinkVersions.includes(i)||this.mulilinkVersions.push(i):this.versions.includes(i)||this.versions.push(i),this.updateVersions(),this.fechEvent(i,t,o),e(r[n].val),this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 曝光了实验"+n,level:"info",time:Date.now(),data:r[n]})):(this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getVar",level:"info",time:Date.now(),data:o}),e(o)):e(o)},Tt.prototype.getAllVars=function(e){if("function"!=typeof e)throw new Error("callback must be a function");e={callback:e,type:ft.All},"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(e):this.callbacks.push(e)},Tt.prototype.getRealAllVars=function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getAllVars",level:"info",time:Date.now(),data:this.data})},Tt.prototype.fechEvent=function(e,t,i){try{var n,o,r,a,s,c;this.config.disable_track_event||e&&(o=(n=this.collect.configManager.get()).header,r=n.user,(a=this.getABCache())&&a.uuid&&a.uuid!==r.user_unique_id||(s={event:"abtest_exposure",ab_sdk_version:""+e,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?i:window.location.href}),local_time_ms:Date.now()},o.custom=JSON.stringify(o.custom),c={events:[s],user:r,header:o},"$ab_url"===t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify([c])):this.reportExposure(c)))}catch(e){this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},Tt.prototype.reportExposure=function(e){var t=this;this.exposureCache.push(e),this.reportTimeout&&clearTimeout(this.reportTimeout),this.exposureCache.length>=this.exposureLimit?this.report():this.reportTimeout=setTimeout((function(){t.report(),clearTimeout(t.reportTimeout)}),this.ab_batch_time)},Tt.prototype.report=function(){var e=this;this.fetch(this.reportUrl,this.exposureCache,2e4),this.exposureCache.forEach((function(t){e.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:[t],code:200,status:"success"})})),this.exposureCache=[]},Tt.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},Tt.prototype.getABconfig=function(e,t){var i=Object.keys(e);i&&i.length&&this.collect.configManager.set(e),this.fetchAB(t)},Tt.prototype.get=function(e){var t;return this.ab_cross?(t=this.cacheStorgae.getCookie(e,this.ab_cookie_domain))?JSON.parse(t):null:this.cacheStorgae.getItem(e)},Tt.prototype.set=function(e,t){this.ab_cross?this.cacheStorgae.setCookie(e,t,2592e6,this.ab_cookie_domain):this.cacheStorgae.setItem(e,t),this.collect.configManager.setAbCache(t)},Tt.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return t=this.get(this.abKey)||t,2592e6<=Date.now()-t.timestamp?(this.cacheStorgae.removeItem(this.abKey),null):e?t[e]:t},Tt.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.set(this.abKey,e)},Tt.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.set(this.abKey,t)},Tt.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[]},Tt.prototype.openOverlayer=function(e){var t,i,n,o,r=this;document.getElementById(Je)||(i="body { opacity: 0 !important; }",n=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("style")).id=Je,o.type="text/css",o.styleSheet?o.styleSheet.cssText=i:o.appendChild(document.createTextNode(i)),n.appendChild(o)),e&&(t=setTimeout((function(){r.closeOverlayer(),clearTimeout(t)}),e))},Tt.prototype.closeOverlayer=function(){var e;(e=document.getElementById(Je))&&e.parentElement.removeChild(e)},Tt.prototype.fetchComplete=function(e,t){var i=this;if(e&&"[object Object]"==Object.prototype.toString.call(e)){this.data=e,this.setAbCache(t);var n,o,r=[],a=(Object.keys(e).forEach((function(t){(t=e[t].vid)&&r.push(t)})),this.versions=this.versions.filter((function(e){return r.includes(e)})),t=e.$ab_url,e.$ab_modification);if(a&&a.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,(function(){var e=a.val;window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.__ab_config=e,ee("https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-loader.js?query="+Date.now(),(function(){console.log("load visual render success")}),(function(){console.log("load visual render fail")})),i.closeOverlayer()}))}else t&&this.enable_multilink&&(this.mulilinkVersions=this.mulilinkVersions.filter((function(e){return r.includes(e)})),n=t.val,o=t.vid,n)&&o&&this.getVar("$ab_url",n,(function(){i.editMode||(n!==window.location.href?setTimeout((function(){if(!i.collect.destroyInstance){var e=-1===(e=""+n).indexOf("http")?"https://"+e:e,t=F(e).host;try{var r=new URL(e);t!==location.host?r.searchParams.append("vid",o):window.history.replaceState("","",e),window.location.href=r.href}catch(t){window.location.href=e}}}),100):i.closeOverlayer())}));this.updateVersions()}else this.closeOverlayer();this.callbacks.forEach((function(e){return i[e.type===ft.Var?"getRealVar":"getRealAllVars"](e,"")})),this.callbacks=[]},Tt.prototype.fetchAB=function(e){var t=this,i=this.collect.configManager.get(),n={header:j({aid:this.config.app_id},i.user||{},i.header||{},{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:window.location.href})};this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 发起AB实验请求",level:"info",logType:"fetch",time:Date.now(),data:n}),this.fetch(this.fetchUrl,n,this.config.ab_timeout||3e3,!1,(function(n){t.fetchStatus="complete",t.refreshFetchStatus="complete";var o=n.data;"success"===n.message?(t.fetchComplete(o,i.user.user_unique_id),e&&e(o)):(t.fetchComplete(null,i.user.user_unique_id),e&&e(null)),t.collect.emit(t.types.AbComplete,o),t.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求成功",level:"info",logType:"fetch",time:Date.now(),data:o})}),(function(){t.fetchStatus="complete",t.refreshFetchStatus="complete",t.fetchComplete(null,i.user.user_unique_id),e&&e(null),t.collect.emit(t.types.AbTimeout),t.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求网络异常",level:"error",logType:"fetch",time:Date.now()})}))},Tt.prototype.filterUrl=function(e){try{var t="",i=(-1!==e.indexOf("&multilink=true")?t="&multilink=true[\0-ÿ]*":-1!==e.indexOf("?multilink=true")&&(t="\\?multilink=true[\0-ÿ]*"),new RegExp(t,"g"));e=e.replace(i,"")}catch(e){}return e},u=Tt;var mt=(kt.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},kt.prototype.enable=function(e,t,i){this.url_path=e,this.url=i,this.title=t,this.disableCallback=this.enablePageAlive()},kt.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},kt.prototype.sendEvent=function(e,t){(t=(t=void 0!==t&&t)?this.aliveDTime:Date.now()-this.sessionStartTime)<0||t>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,j({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:t,is_support_visibility_change:W(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:e},this.options.params)),this.sessionStartTime=Date.now())},kt.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},kt.prototype.setUpTimer=function(){var e=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval((function(){Date.now()-e.sessionStartTime>e.aliveDTime&&e.sendEvent(!1,!0)}),1e3)},kt.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},kt.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},kt.prototype.enablePageAlive=function(){var e=this,t=(this.timerHandler=this.setUpTimer(),this.visibilitychange.bind(this)),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),J(i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},kt),_t=(St.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},St.prototype.enable=function(e,t,i){this.url_path=e,this.url=i,this.title=t,this.disableCallback=this.enablePageClose()},St.prototype.disable=function(){this.disableCallback()},St.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0},St.prototype.sendEventPageClose=function(){var e=Date.now()-this.pageStartTime;this.totalTime<0||e<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,j({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:e,is_support_visibility_change:W()},this.options.params)),this.pageStartTime=Date.now(),this.resetData())},St.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},St.prototype.enablePageClose=function(){var e=this,t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),J(i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},St),vt=(wt.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.config.enable_stay_duration&&(this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new mt(e,t),this.pageClose=new _t(e,t),e=this.collect.Types,this.collect.on(e.ResetStay,(function(e){var t=e.url_path,n=e.title;e=e.url,i.resetStayDuration(t,n,e)})),this.collect.on(e.RouteChange,(function(e){e.init||t.disable_route_report||i.resetStayDuration()})),this.collect.on(e.SetStay,(function(e){var t=e.url_path,n=e.title;e=e.url,i.setStayParmas(t,n,e)})),this.enable(this.url_path,this.title,this.url),this.ready(e.Stay),this.collect.emit(e.StayReady))},wt.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(Object.keys(i).length)for(var n in i)!function(e){i[e].length&&i[e].forEach((function(i){t.collect.hook.emit(e,i)}))}(n)}},wt.prototype.enable=function(e,t,i){this.pageAlive.enable(e,t,i),this.pageClose.enable(e,t,i)},wt.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},wt.prototype.setStayParmas=function(e,t,i){this.pageAlive.setParams(e=void 0===e?"":e,t=void 0===t?"":t,i=void 0===i?"":i),this.pageClose.setParams(e,t,i),this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayParams",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},wt.prototype.reset=function(e,t,i){this.disable(),this.enable(e,t,i)},wt.prototype.resetStayDuration=function(e,t,i){this.reset(e,t,i),this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayDuration",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},p=wt,Et.prototype.apply=function(e,t){var i=this,n=(this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list",e.Types),o=e.adapters.fetch;this.eventCheck=new pe(e,t),this.fetch=o,this.cache={},this.collect.on(n.ProfileSet,(function(e){i.setProfile(e)})),this.collect.on(n.ProfileSetOnce,(function(e){i.setOnceProfile(e)})),this.collect.on(n.ProfileUnset,(function(e){i.unsetProfile(e)})),this.collect.on(n.ProfileIncrement,(function(e){i.incrementProfile(e)})),this.collect.on(n.ProfileAppend,(function(e){i.appendProfile(e)})),this.collect.on(n.ProfileClear,(function(){i.cache={}})),this.ready(n.Profile)},Et.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(Object.keys(i).length)for(var n in i)!function(e){i[e].length&&i[e].forEach((function(i){t.collect.hook.emit(e,i)}))}(n)}},Et.prototype.report=function(e,t){void 0===t&&(t={});try{var i,n;this.config.disable_track_event||((i=[]).push(this.collect.processEvent(e,t)),n=this.collect.eventManager.merge(i,!0),this.fetch(this.reportUrl,n),this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:n,code:200,status:"success"}))}catch(e){this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},Et.prototype.setProfile=function(e){(e=this.formatParams(e))&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set",j({},e,{profile:!0})))},Et.prototype.setOnceProfile=function(e){(e=this.formatParams(e,!0))&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set_once",j({},e,{profile:!0})))},Et.prototype.incrementProfile=function(e){e?this.report("__profile_increment",j({},e,{profile:!0})):console.warn("please check the params, must be object!!!")},Et.prototype.unsetProfile=function(e){var t;e?((t={})[e]="1",this.report("__profile_unset",j({},t,{profile:!0}))):console.warn("please check the key, must be string!!!")},Et.prototype.appendProfile=function(e){if(e){var t,i={};for(t in e)"string"==typeof e[t]||"Array"===Object.prototype.toString.call(e[t]).slice(8,-1)?i[t]=e[t]:console.warn("please check the value of param: "+t+", must be string or array !!!");Object.keys(i).length&&this.report("__profile_append",j({},i,{profile:!0}))}else console.warn("please check the params, must be object!!!")},Et.prototype.pushCache=function(e){var t=this;Object.keys(e).forEach((function(i){t.cache[i]={val:t.clone(e[i]),timestamp:Date.now()}}))},Et.prototype.formatParams=function(e,t){var i=this;void 0===t&&(t=!1);try{if(e&&"[object Object]"===Object.prototype.toString.call(e)){var n,o={};for(n in e)"string"==typeof e[n]||"number"==typeof e[n]||"Array"===Object.prototype.toString.call(e[n]).slice(8,-1)?o[n]=e[n]:console.warn("please check the value of params:"+n+", must be string,number,Array !!!");var r,a=Object.keys(o);if(a.length)return r=Date.now(),a.filter((function(n){var o=i.cache[n];return t?!o:!(o&&i.compare(o.val,e[n])&&r-o.timestamp<i.duration)})).reduce((function(e,t){return e[t]=o[t],e}),{})}else console.warn("please check the params type, must be object !!!")}catch(e){this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("error")}},Et.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),!1}},Et.prototype.clone=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),e}},Et.prototype.unReady=function(){console.warn("sdk is not ready, please use this api after start")},f=Et,bt.prototype.apply=function(e,t){var i=this;this.collect=e,t.disable_heartbeat||(this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval(),e=this.collect.Types,this.collect.on(e.SessionReset,(function(){i.process()})))},bt.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},bt.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},bt);function yt(){}function bt(){var e=this;this.setInterval=function(){var t,i,n,o;e.clearIntervalFunc=(t=function(){e.isSessionhasEvent&&e.endCurrentSession()},i=e.sessionInterval,void 0===t&&(t=function(){}),void 0===i&&(i=1e3),n=Date.now()+i,o=window.setTimeout((function e(){var r=Date.now()-n;t(),n+=i,o=window.setTimeout(e,Math.max(0,i-r))}),i),function(){window.clearTimeout(o)})},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}function Et(){}function wt(){}function St(e,t){var i=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?i.activeEndTime=Date.now():"visible"===document.visibilityState&&(i.activeEndTime&&(i.totalTime+=i.activeEndTime-i.activeStartTime,i.activeTimes+=1),i.activeEndTime=void 0,i.activeStartTime=Date.now())},this.beforeunload=function(){if(i.totalTime+=(i.activeEndTime||Date.now())-i.activeStartTime,i.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:i.totalTime,page_title:document.title||location.pathname}))}catch(e){}i.sendEventPageClose()},this.collect=e,this.config=t,this.maxDuration=t.maxDuration||864e5,this.pageStartTime=Date.now(),q(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.resetData()}function kt(e,t){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=e,this.config=t,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,q(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration))}function Tt(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[]}function At(e,t){if(void 0===t&&(t="list"),e)if(t&&"list"===t){if(["LI","TR","DL"].includes(e.nodeName))return 1;if(e.dataset&&e.dataset.hasOwnProperty("teaIdx"))return 1;if(e.hasAttribute&&e.hasAttribute("data-tea-idx"))return 1}else{if(["A","BUTTON"].includes(e.nodeName))return 1;if(e.dataset&&e.dataset.hasOwnProperty("teaContainer"))return 1;if(e.hasAttribute&&e.hasAttribute("data-tea-container"))return 1;if(e.hasAttribute&&xt(e,"ss"))return 1}}yt.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.config.channel_domain||this.config.disable_track_event||this.config.disable_sdk_monitor||(t=e.adapters.fetch,this.fetch=t,this.url=e.configManager.getUrl("event"),t=this.collect.Types,this.collect.on(t.Ready,(function(){i.sdkOnload()})),this.collect.on(t.SubmitError,(function(e){var t=e.type,n=e.eventData;e=e.errorCode,"f_data"===t&&i.sdkError(n,e)})))},yt.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),i=t.header,n=t.user,o=i.app_id,r=i.app_name,a=i.sdk_version,s=n.web_id,c={events:[{event:"onload",params:JSON.stringify({app_id:o,app_name:r||"",sdk_version:a,sdk_type:"npm",sdk_config:this.config,sdk_desc:"TOB"}),local_time_ms:Date.now()}],user:{user_unique_id:s},header:{}};setTimeout((function(){e.fetch(e.url,[c],3e4,!1,(function(){}),(function(){}),"566f58151b0ed37e")}),16)}catch(e){}},yt.prototype.sdkError=function(e,t){var i=this;try{var n=e[0],o=n.user,r=n.header,a=[],s=(e.forEach((function(e){e.events.forEach((function(e){a.push(e)}))})),{events:a.map((function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:r.app_id,app_name:r.app_name||"",error_event:e.event,sdk_version:r.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(r),user:JSON.stringify(o)}),local_time_ms:Date.now()}})),user:{user_unique_id:o.user_unique_id},header:{}});setTimeout((function(){i.fetch(i.url,[s],3e4,!1,(function(){}),(function(){}),"566f58151b0ed37e")}),16)}catch(e){}},g=yt;var Dt=function(e,t){return!!xt(e,t)};function Ot(e){for(var t=e;t&&!At(t,"container");){if("HTML"===t.nodeName||"BODY"===t.nodeName)return e;t=t.parentElement}return t||e}function Ct(e){var t="";return 3===e.nodeType?t=e.textContent.trim():e.dataset&&e.dataset.hasOwnProperty("teaTitle")||e.hasAttribute("ata-tea-title")?t=e.getAttribute("data-tea-title"):e.hasAttribute("title")?t=e.getAttribute("title"):"INPUT"===e.nodeName&&["button","submit"].includes(e.getAttribute("type"))?t=e.getAttribute("value"):"IMG"===e.nodeName&&e.getAttribute("alt")&&(t=e.getAttribute("alt")),t.slice(0,200)}var It=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0},xt=function(e,t){if("string"==typeof t)return It(e,t);if(Z(t)){for(var i=!1,n=0;n<t.length;n++)if(It(e,t[n])){i=!0;break}return i}},Mt=(Bt.prototype.init=function(e){this.eventHandel=e,e=this.config.mode,this.addListener(e)},Bt.prototype.addListener=function(e){var t=this;if("proxy-capturing"===e&&(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv&&this.collect.on("route-change",(function(e){var i=e.config;e=e.name,t.getPageViewEvent(i,e)})),this.config.beat)){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",(function(){t.beatEvent(t.beatTime)}));var i=0,n=null,o=(window.addEventListener("scroll",(function(){clearTimeout(n),n=setTimeout(o,500),i=document.documentElement.scrollTop||document.body.scrollTop})),function(){(document.documentElement.scrollTop||document.body.scrollTop)==i&&t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})})}catch(e){}try{var r=window.performance&&window.performance.getEntriesByType("paint");r&&r.length?(new PerformanceObserver((function(e){e=(e=(e=e.getEntries())[e.length-1]).renderTime||e.loadTime,t.statistics||(t.getPageLoadEvent(e),t.statistics=!0)})).observe({entryTypes:["largest-contentful-paint"]}),setTimeout((function(){t.statistics||(t.getPageLoadEvent(r[0].startTime||0),t.statistics=!0)}),2e3)):this.getPageLoadEvent(0)}catch(e){this.getPageLoadEvent(0)}}},Bt.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},Bt.prototype.beatEvent=function(e){var t,i=this;try{this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(t=setInterval((function(){i.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})}),e)),J((function(){i.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),i.beatTime&&clearInterval(t)}))}catch(e){}},Bt),Rt={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},Gt=(Pt.prototype.getConfig=function(){return this.config},Pt.prototype.setConfig=function(e){return this.config=e},Pt);function Pt(e,t){this.config=e,this.config.eventConfig=Object.assign(this.config.eventConfig,t)}function Bt(e,t,i){var n=this;this.clickEvent=function(e){!function(e,t){if(1===e.nodeType&&(t.svg||!function(e){if("svg"===e.tagName.toLowerCase())return 1;for(var t=e.parentElement,i=!1;t;)"svg"===t.tagName.toLowerCase()?i=!(t=null):t=t.parentElement;return i}(e))&&!["HTML","BODY"].includes(e.tagName.toUpperCase()))return"none"!==e.style.display&&(At(e,"container")||t.track_attr&&Dt(e,t.track_attr)||!e.children.length||(t=e.children,![].slice.call(t).some((function(e){return 0<e.children.length}))))}(e.target,n.options)||n.eventHandel({eventType:"dom",eventName:"click"},e)},this.changeEvent=function(e){n.eventHandel({eventType:"dom",eventName:"change"},e)},this.submitEvent=function(e){n.eventHandel({eventType:"dom",eventName:"submit"},e)},this.getPageViewEvent=function(e,t){t&&"pushState"===t&&n.eventHandel({eventType:"dom",eventName:"beat"},j({beat_type:0},e)),n.eventHandel({eventType:"dom",eventName:"page_view"},e)},this.getPageLoadEvent=function(e){n.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:e})},this.config=i.getConfig().eventConfig,this.collect=t,this.options=e,this.beatTime=e.beat,this.statistics=!1}function Nt(e,t,i,n){var o,r,a={},s=function(){var e,i,n;if(t)return i=(e=t.getBoundingClientRect()).width,n=e.height,{left:e.left,top:e.top,element_width:i,element_height:n}}(),c=(c=s,e=(h=void 0===(h=e)?{}:e).clientX,h=h.clientY,l=(c=void 0===c?{}:c).left,h=0<=h-(c=c.top)?h-c:0,{touch_x:Math.floor(0<=e-l?e-l:0),touch_y:Math.floor(h)}),l=(e=s.element_width,s.element_height),h=c.touch_x,u=(s=c.touch_y,c=function(e){for(var t=[];null!==e.parentElement;)t.push(e),e=e.parentElement;var i=[],n=[];return t.forEach((function(e){e=function(e){if(null===e)return{str:"",index:0};var t=0,i=e.parentElement;if(i)for(var n=i.children,o=0;o<n.length&&n[o]!==e;o++)n[o].nodeName===e.nodeName&&t++;return{str:[e.nodeName.toLowerCase(),At(e,"list")?"[]":""].join(""),index:t}}(e);var t=e.str;e=e.index,i.unshift(t),n.unshift(e)})),{element_path:"/"+i.join("/"),positions:n}}(t),c.element_path),p=(c=c.positions,p=Ot(t),o=[],function e(t){var i=Ct(t);if(i&&-1===o.indexOf(i)&&o.push(i),0<t.childNodes.length)for(var n=t.childNodes,r=0;r<n.length;r++)8!==n[r].nodeType&&e(n[r])}(p),o),f=window.performance.timing.navigationStart,d=Date.now()-f,g=(c=c.map((function(e){return""+e})),null);if(window.TEAVisualEditor.getOriginXpath&&(g=window.TEAVisualEditor.getOriginXpath({xpath:u,positions:c})),a.element_path=g&&g.xpath||u,a.positions=g&&g.positions||c,n&&!n.text&&(a.texts=p,a.element_title=(u=Ot(t),r="",function e(t){var i=Ct(t);if(i&&(r+=i),0<t.childNodes.length)for(var n=t.childNodes,o=0;o<n.length;o++)3===n[o].nodeType&&e(n[o])}(u),r)),a.element_id=t.getAttribute("id")||"",a.element_class_name=t.getAttribute("class")||"",a.element_type=t.nodeType,a.element_width=Math.floor(e),a.element_height=Math.floor(l),a.touch_x=h,a.touch_y=s,a.page_manual_key="",a.elememt_manual_key="",a.since_page_start_ms=d,a.page_start_ms=f,a.page_path=location.pathname,a.page_host=location.host,i.track_attr&&Dt(t,i.track_attr)){var m,_=function(e,t){var i={};if("string"==typeof t)It(e,t)&&(i.attrs=e.getAttribute(t));else if(Z(t))for(var n=0;n<t.length;n++)It(e,t[n])&&(i[t[n]]=e.getAttribute(t[n]));return i}(t,i.track_attr);for(m in _)a[m]=_[m]}return"A"===(g=Ot(t)).tagName&&(a.href=g.getAttribute("href")),"IMG"===t.tagName&&(a.src=t.getAttribute("src")),a}function Ut(e,t,i,n,o){return j({event:e},Nt(t,i,n,o),{is_html:1,page_key:window.location.href,page_title:document.title})}jt.prototype.handleEvent=function(e,t){try{if(function(){for(var t=e.target;t&&t.parentNode;){if(t.hasAttribute("data-tea-ignore"))return 1;if("HTML"===t.nodeName||"body"===t.nodeName)return;t=t.parentNode}}())return null;var i="bav2b_click";switch(t){case"click":return Ut(i=this.eventName.click,e,e.target,this.options,this.ignore);case"exposure":return Ut(i=this.eventName.exposure,e,e.target,this.options,this.ignore);case"change":return j({},Ut(i="bav2b_change",e,e.target,this.options),function(e,t){try{if("bav2b_change"===e)return t.hasAttribute("data-tea-track")?{value:t.value}:{}}catch(e){return{}}}(i,e.target));case"submit":return Ut(i="bav2b_submit",e,e.target,this.options)}}catch(t){return console.error(t),null}},jt.prototype.handleViewEvent=function(e){e.event=this.eventName.page,e.page_title=document.title,e.page_total_width=window.innerWidth,e.page_total_height=window.innerHeight;try{var t,i=window.sessionStorage.getItem("_tea_cache_duration");i&&(t=JSON.parse(i),e.refer_page_duration_ms=t?t.duration:""),e.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,e.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("page event error "+JSON.stringify(e))}return e},jt.prototype.handleStatisticsEvent=function(e){var t={};t.event=this.eventName.static,t.is_html=1,t.page_key=location.href,t.refer_page_key=document.referrer||"",t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"",t.refer_page_manual_key="";try{var i=e.lcp,n=window.performance.timing,o=n.loadEventEnd-n.navigationStart;t.page_init_cost_ms=parseInt(i||(0<o?o:0)),t.page_start_ms=n.navigationStart}catch(e){console.log("page_statistics event error "+JSON.stringify(e))}return t},jt.prototype.handleBeadtEvent=function(e){e.event=this.eventName.beat,e.page_key=window.location.href,e.is_html=1,e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{e.page_viewport_width=window.innerWidth,e.page_viewport_height=window.innerHeight,e.page_total_width=document.documentElement.scrollWidth,e.page_total_height=document.documentElement.scrollHeight,e.scroll_width=document.documentElement.scrollLeft+window.innerWidth,e.scroll_height=document.documentElement.scrollTop+window.innerHeight,e.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("beat event error "+JSON.stringify(e))}return e};var Vt=jt,zt=(Lt.prototype.send=function(e,t){e=e.eventSend;var i=t.event;delete t.event,e&&"becon"===e?this.collect.beconEvent(i,t):this.collect.event(i,t)},Lt.prototype.get=function(e,t){t=Object.assign({headers:{"content-type":"application/json"},method:"GET"},t),fetch(e,t)},Lt.prototype.post=function(e,t){t=Object.assign({headers:{"content-type":"application/json"},method:"POST"},t),fetch(e,t)},Lt);function Lt(e){this.collect=e,this.eventNameList=["report_click_event","report_change_event","report_submit_event","report_exposure_event","report_page_view_event","report_page_statistics_event","report_beat_event"]}function jt(e,t){this.ignore={text:!1},this.initConfig=e,this.options=t,this.eventName=t&&"tea"===t.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"bav2b_exposure"},t&&!1===t.text&&(this.ignore.text=!0),t&&t.exposure&&t.exposure.eventName&&(this.eventName.exposure=t.exposure.eventName)}function Kt(){try{var e=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||ie.get("lang"),t=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||ie.get("_TEA_VE_APIHOST"),i=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||ie.get("_VISUAL_EDITOR_V"),n=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||ie.get("_VISUAL_EDITOR_U"),o=+new Date,r=new Date(18e5+o);ie.set("_TEA_VE_OPEN","1",{expires:r}),ie.set("_TEA_VE_APIHOST",t,{expires:r}),ie.set("_VISUAL_EDITOR_U",n,{expires:r}),ie.set("lang",e,{expires:r}),ie.set("_VISUAL_EDITOR_V",i||"",{expires:r})}catch(e){console.log("set cookie err")}}var qt=!1;function Ht(e){var t=e.event,i=e.editorUrl,n=e.autoTrackInstance;qt||(qt=!0,ee(i,(function(){ct(t,"editorScriptloadSuccess"),n.destroy()}),(function(){t&&ct(t,"editorScriptloadError"),qt=!1})))}si.prototype.init=function(){var e=this;MutationObserver?(this._instance=new MutationObserver((function(t){t.forEach((function(t){"attributes"===t.type&&e.attributeChangeObserve(t),"childList"===t.type&&e.modifyNodeObserve(t)}))})),this._instance.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})):console.log("your browser cannot support MutationObserver")},si.prototype.attributeChangeObserve=function(e){e.target.hasAttribute("data-exposure")?this.exposureAdd(e,"mutation"):this.exposureRemove(e)},si.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureAdd(e,"intersect"),t.mapChild(e,t.exposureAdd)})),Array.prototype.forEach.call(e.removedNodes,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureRemove(e),t.mapChild(e,t.exposureRemove)}))},si.prototype.mapChild=function(e,t){var i=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t(e),i.mapChild(e,t)}))},si.prototype.exposureAdd=function(e,t){try{this._intersection&&this._intersection.exposureAdd(e,t)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},si.prototype.exposureRemove=function(e){try{this._intersection&&this._intersection.exposureRemove(e)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},si._exposure_observer=null;var Jt=si,Wt=(ai.prototype.buildObserver=function(){var e=this;return ai._observer_instance?(console.log("your browser cannot support IntersectionObserver"),null):ai._observer_instance=IntersectionObserver?new IntersectionObserver((function(t){t.forEach((function(t){e.observeMap.get(t.target._observeId)&&e.exposureEvent(t)}))}),{threshold:[.01,.25,.5,.75,1]}):ai._observer_instance},ai.prototype.exposureAdd=function(e,t){var i,n,o,r=e;(t=(r="mutation"===t?e.target:r)._observeId)||this.observeMap.has(t)?!1===r.visible&&(i=(t=r.getBoundingClientRect()).top,n=t.left,o=t.right,t=t.bottom,0<=i)&&t<=window.innerHeight&&0<=n&&o<=window.innerWidth&&(r.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e)):(r._observeId=this.count,r.visible=!1,this.observeMap.set(this.count,r),this.observe(r),this.count++)},ai.prototype.exposureRemove=function(e){this.observeMap.has(e._observeId)&&(this.observeMap.delete(e._observeId),this.unobserve(e))},ai.prototype.exposureEvent=function(e){e.intersectionRatio>=this.Ratio&&e.isIntersecting?"0"!==e.target.style.opacity&&"hidden"!==e.target.style.visibility&&!0!==e.target.visible&&(e.target.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e)):e.target.visible=!1},ai.prototype.observe=function(e){this.instance&&this.instance.observe(e)},ai.prototype.unobserve=function(e){this.instance&&this.instance.unobserve(e)},ai._observer_instance=null,ai._observer_map=new Map,ai),Ft=(ri.prototype.initObserver=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),(function(t){e._intersection.exposureAdd(t,"intersect")}))},ri),$t={hashTag:!1,impr:!1},Xt=(oi.prototype.apply=function(e,t){this.autoTrackStart=!1,this.collect=e,(this.config=t).autotrack&&(e=e.Types,t.autotrack&&t.autotrack.collect_url&&!t.autotrack.collect_url()||(this.ready(e.Autotrack),this.collect.emit(e.AutotrackReady)))},oi.prototype.ready=function(e){this.collect.set(e),e="object"==L(e=this.config.autotrack)?e:{};var t=(e=Object.assign($t,e),this.destroyed=!1,this.options=e,this.Config=new Gt(Rt,this.options),this.Exposure=new Ft(this.config,this.handle.bind(this)),this.Listener=new Mt(e,this.collect,this.Config),this.EventHandle=new Vt(this.config,e),this.Request=new zt(this.collect),this.autoTrackStart=!0,this.init(),this),i=(e=this.config,window.TEAVisualEditor=window.TEAVisualEditor||{},""),n="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-editor-rangers.js?query="+Date.now(),o=(window.TEAVisualEditor.appId=e.app_id,e.channel_domain),r="";if(rt(["*"]),o){var a,s="";try{var c=window.performance.getEntriesByType("resource");if(c&&c.length&&(c.forEach((function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(s=e.name)})),s||document.currentScript&&(s=document.currentScript.src),s)&&(a=s.split("/"))&&a.length){r="https:/";for(var l=2;l<a.length&&l!==a.length-1;l++)r=r+"/"+a[l];r&&r.indexOf("/5.0")&&(r=r.split("/5.0")[0]||r)}}catch(t){}}if(ut(e,"0.0.1"),"1"===ie.get("_TEA_VE_OPEN"))c=function(){var e=ie.get("_TEA_VE_APIHOST");try{e=JSON.parse(e)}catch(e){}return e}(),e="",c&&(window.TEAVisualEditor.__editor_ajax_domain=c,e=ie.get("_VISUAL_EDITOR_U")),Ht({event:null,editorUrl:e||n,autoTrackInstance:t}),Kt();else try{lt("tea:openVisualEditor",(function(e){var a,s,c=e.data;if("string"==typeof e.data)try{c=JSON.parse(e.data)}catch(e){c=void 0}c&&(s=c.referrer,a=c.lang,s&&(window.TEAVisualEditor.__editor_ajax_domain=s),i=n,o&&(s=c.version,i=r?r+(s?"/visual-editor-rangers-v"+s:"/visual-editor-rangers-v1.0.0")+".js":n,window.TEAVisualEditor.__editor_verison=s),window.TEAVisualEditor.__editor_url=i,window.TEAVisualEditor.lang=a,Ht({event:e,editorUrl:i,autoTrackInstance:t}),Kt())})),window.TEAVisualEditor.openAutotrackEditor=function(){Ht({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:t})}}catch(t){console.log("receive message error")}try{lt("tea:openHeatMapCore",(function(e){Ht({event:e,editorUrl:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/heatmap-core.js?query="+Date.now(),autoTrackInstance:t})}))}catch(t){console.log("openHeatMapCore error")}},oi.prototype.init=function(){this.Listener.init(this.handle.bind(this))},oi.prototype.handle=function(e,t){"dom"===e.eventType&&this.handleDom(e,t)},oi.prototype.handleDom=function(e,t){try{var i,n,o,r,a=e.eventName;"click"===a||"exposure"===a||"change"===a||"submit"===a?null!==(i=this.EventHandle.handleEvent(t,a))&&this.Request.send({eventType:"custom",eventName:"report_"+a+"_event",extra:{methods:"GET"}},i):"page_view"===a||"page_statistics"===a?(n=void 0,n="page_view"===a?this.EventHandle.handleViewEvent(t):this.EventHandle.handleStatisticsEvent(t),this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"}},n)):"beat"===a&&(o=this.EventHandle.handleBeadtEvent(t),r=e.eventSend,this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"},eventSend:r},o))}catch(e){console.log("handel dom event error "+JSON.stringify(e))}},oi.prototype.destroy=function(){if(!this.autoTrackStart)return console.warn("engine is undefined, make sure you have called autoTrack.start()");this.autoTrackStart=!1,this.Listener.removeListener()},m=oi,ni.prototype.apply=function(e,t){var i=this;this.collector=e,this.config=t,t=e.adapters.storage,this.cacheStorgae=new t(!1,"session"),this.eventStorage=[],this.collector.on("submit-verify",(function(e){e&&e.length&&i.eventStore(e[0])})),this.checkCache()},ni.prototype.checkCache=function(){var e=this,t=(this.verifyCookieKey="__applog_verify_set_"+this.config.app_id,this.cacheStorgae.getCookie(this.verifyCookieKey),this.cacheStorgae.getItem(this.verifyCookieKey)),i=(this.sign=t&&t.sign||"",this.origin=t&&t.origin||"*",setTimeout((function(){e.cleanVerify(),clearTimeout(i),e.collector.off("submit-verify")}),this.waitTime));window.addEventListener("message",(function(t){t&&t.data&&"simulator:verify"===t.data.type&&(clearTimeout(i),e.receMessage(t))}),!0)},ni.prototype.receMessage=function(e){var t;this.cleanStatus||(t=e.data,this.verifyReady=!0,this.sign=t.sign,this.origin=e.origin,this.cacheStorgae.setItem(this.verifyCookieKey,JSON.stringify({sign:t.sign,origin:e.origin})),this.eventStorage.length&&this.postVerify(this.eventStorage,t.sign,e.origin))},ni.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e,this.sign,this.origin):this.eventStorage.push(e))},ni.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[]},ni.prototype.postVerify=function(e,t,i){try{var n=[],o=(Z(e)?e.forEach((function(e){n.push(e)})):n.push(e),{type:"simulator:verify:event",sign:t,pageUrl:window.location.href,events:n});(window.opener||window.parent).postMessage(o,i)}catch(e){console.log("web verify post message error ~")}},h=ni,ii.prototype.apply=function(e,t){(t.spa||t.autotrack)&&(this.collect=e,this.config=t,this.appid=t.app_id,this.allowHash=t.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),t=e.Types,e.emit(t.RouteReady))},ii.prototype.setKey=function(){var e=this.collect.adapters.storage;this.storage=new e(!1),this.cache_key="__tea_cache_refer_"+this.appid,this.cache={refer_key:location.href,refer_title:document.title||location.pathname,refer_manual_key:""},this.config.autotrack&&"object"==L(this.config.autotrack)&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},ii.prototype.hack=function(){var e=this,t=window.history.pushState,i=(history.pushState=function(i){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var r;if("function"==typeof history.onpushstate&&history.onpushstate({state:i}),i=t.call.apply(t,K([history,i],n)),e.lastLocation!==location.href)return r=e.getPopStateChangeEventData(),e.lastLocation=location.href,e.sendPv(r,"pushState"),i},history.replaceState);history.replaceState=function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var r;if("function"==typeof history.onreplacestate&&history.onreplacestate({state:t}),t=i.call.apply(i,K([history,t],n)),e.lastLocation!==location.href)return r=e.getPopStateChangeEventData(),e.lastLocation=location.href,e.sendPv(r),t}},ii.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},ii.prototype.init=function(){var e=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:e,init:!0})},ii.prototype.listener=function(){var e=this,t=null;window.addEventListener("hashchange",(function(i){var n;e.lastLocation!==window.location.href&&(clearTimeout(t),e.allowHash)&&(e.lastLocation=window.location.href,n=e.getPopStateChangeEventData(),e.sendPv(n))})),window.addEventListener("popstate",(function(i){e.lastLocation!==window.location.href&&(t=setTimeout((function(){e.lastLocation=window.location.href;var t=e.getPopStateChangeEventData();e.sendPv(t)}),10))}))},ii.prototype.getPopStateChangeEventData=function(){var e=this.pageConfig();return e.is_back=0,e},ii.prototype.pageConfig=function(){try{var e=this.storage.getItem(this.cache_key)||{},t=document.referrer||e&&e.refer_key||"",i=this.storage.getItem("__tea_cache_first_"+this.appid),n=!i||1!=i;return{is_html:1,url:location.href,referrer:t,page_key:location.href,refer_page_key:t,page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:e&&e.refer_manual_key||"",refer_page_title:e&&e.refer_title||"",page_path:location.pathname,page_host:location.host,is_first_time:""+n}}catch(t){return this.collect.emit(re.DEBUGGER_MESSAGE,{type:re.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),{}}},ii.prototype.sendPv=function(e,t){this.collect.emit("route-change",{config:e,init:!1})},l=ii,ti.prototype.apply=function(e,t){var i=this;this.collector=e,this.config=t,this.eventStorage=[],this.collector.on("submit-verify-h5",(function(e){e&&e.length&&i.eventStore(e[0])})),this.checkUrl(),this.heartbeat()},ti.prototype.checkUrl=function(){var e;(e=$(e=window.location.href))._r_d_&&e._r_c_k_?(this.verifyReady=!0,this.domain=e._r_d_,this.key=e._r_c_k_,this.checkCache()):this.collector.off("submit-verify-h5")},ti.prototype.checkCache=function(){this.eventStorage.length&&this.postVerify(this.eventStorage)},ti.prototype.heartbeat=function(){var e=this;this.heart=setInterval((function(){var t={event:"simulator_test__",local_time_ms:Date.now()},i=e.collector.configManager.get(),n=i.header;t={events:[t],user:i.user,header:n},e.eventStore(t)}),6e4)},ti.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e):this.eventStorage.push(e))},ti.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[],clearInterval(this.heart)},ti.prototype.postVerify=function(e){var t=this;try{var i=JSON.parse(JSON.stringify(e));Z(e)?i.forEach((function(e){t.fetchLog(e)})):this.fetchLog(i)}catch(e){console.log("web verify post error ~")}},ti.prototype.fetchLog=function(e){Oe(this.domain+"/simulator/h5/log?connection_key="+this.key,e,2e4,!1)},ti.prototype.leave=function(){var e=this;document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.cleanVerify()})),J((function(){e.cleanVerify()}))},ti),Qt=(ei.prototype.apply=function(e,t){var i,n,o,r=this;!t.enable_storage||t.disable_storage||(this.collect=e,this.config=t,this.collect.destroyInstance)||(i=e.Types,n=(o=e.adapters).storage,o=o.fetch,this.storage=new n(!1),this.fetch=o,this.eventUrl=this.collect.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+t.app_id,this.storageNum=t.storage_num||50,this.retryNum=t.retry_num||3,this.retryInterval=1e3,e.on(i.SubmitError,(function(e){"f_data"===e.type&&r.storeData(e)})),e.on(i.Ready,(function(){r.checkStorage()})))},ei.prototype.retryRightNow=function(e){var t,i,n=this;this.retryStatus?this.errorCache.push(e):(t=0,this.retryStatus=!0,i=setInterval((function(){var o;3===t?(n.storeData(n.errorCache),n.retryStatus=!1,clearInterval(i)):(o=e.eventData,n.fetchData(o,(function(){n.retryStatus=!1,clearInterval(i),n.retryCacheStatus&&n.errorCache.splice(0,1),n.errorCache.length&&(n.retryCacheStatus=!0,n.retryRightNow(n.errorCache[0]))}),(function(){t++})))}),this.retryInterval))},ei.prototype.storeData=function(e){var t=this.storage.getItem(this.eventKey);e=e.eventData,Object.keys(t).length!==this.storageNum&&(t[Date.now()]=e,this.storage.setItem(this.eventKey,t))},ei.prototype.checkStorage=function(){var e,t,i=this;try{window.navigator.onLine&&(e=this.storage.getItem(this.eventKey))&&Object.keys(e).length&&(t={events:[{event:"ontest",params:{app_id:this.config.app_id},local_time_ms:Date.now()}],user:{user_unique_id:this.collect.configManager.get("web_id")},header:{}},this.fetchData([t],(function(){var t,n=JSON.parse(JSON.stringify(e));for(t in e)!function(t){i.fetchData(e[t],(function(){delete n[t],i.storage.setItem(i.eventKey,n)}),(function(){}),!1)}(t)}),(function(){}),!0))}catch(i){console.warn("error check storage")}},ei.prototype.fetchData=function(e,t,i,n){this.fetch(this.eventUrl,e,3e4,!1,(function(){t&&t()}),(function(){i&&i(),console.log("network error，compensate report failk")}),n&&!this.config.channel_domain?"566f58151b0ed37e":"")},ei),Yt=(Zt.prototype.apply=function(e,t){var i=this;this.collector=e,this.config=t,t=e.Types,e.on(t.TrackDurationStart,(function(e){i.trackStart(e)})),e.on(t.TrackDurationEnd,(function(e){i.trackEnd(e)})),e.on(t.TrackDurationPause,(function(e){i.trackPause(e)})),e.on(t.TrackDurationResume,(function(e){i.trackResume(e)})),this.Types=t,this.TrackMap=new Map,this.ready(t.TrackDuration)},Zt.prototype.ready=function(e){var t=this;if(this.collector.set(e),this.collector.hook._hooksCache.hasOwnProperty(e)){var i=this.collector.hook._hooksCache[e];if(Object.keys(i).length)for(var n in i)!function(e){i[e].length&&i[e].forEach((function(i){t.collector.hook.emit(e,i)}))}(n)}},Zt.prototype.trackStart=function(e){this.TrackMap.set(e,{startTime:Date.now(),isPause:!1,pauseTime:0,resumeTime:0})},Zt.prototype.trackEnd=function(e){var t,i,n=e.eventName;e=e.params,this.TrackMap.has(n)&&(t=0,t=(i=this.TrackMap.get(n)).isPause?i.pauseTime-i.startTime:i.resumeTime?i.pauseTime-i.startTime+(Date.now()-i.resumeTime):Date.now()-i.startTime,i=Object.assign(e,{event_duration:t}),this.collector.event(n,i),this.cleanTrack(n))},Zt.prototype.trackPause=function(e){var t;this.TrackMap.has(e)&&!(t=this.TrackMap.get(e)).isPause&&(t.isPause=!0,t.pauseTime=Date.now(),this.TrackMap.set(e,t))},Zt.prototype.trackResume=function(e){var t;this.TrackMap.has(e)&&(t=this.TrackMap.get(e)).isPause&&(t.isPause=!1,t.resumeTime=Date.now(),this.TrackMap.set(e,t))},Zt.prototype.cleanTrack=function(e){this.TrackMap.delete(e)},Zt);function Zt(){}function ei(){this.retryWaitTime=3e3,this.retryStatus=!1,this.retryCacheStatus=!1}function ti(){this.verifyReady=!1,this.cleanStatus=!1}function ii(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}function ni(){this.verifyReady=!1,this.waitTime=5e3,this.cleanStatus=!1}function oi(){}function ri(e,t){e.autotrack&&e.autotrack.exposure&&(this._intersection=new Wt(e,t),this._observer=new Jt(this._intersection),this._intersection&&this._observer?this.initObserver():console.log("your browser version cannot support exposure, please update~"))}function ai(e,t){this.count=1,this.instance=this.buildObserver(),this.observeMap=ai._observer_map,e.autotrack.exposure.ratio?this.Ratio=e.autotrack.exposure.ratio:0===e.autotrack.exposure.ratio?this.Ratio=0:this.Ratio=.5,this.EventHandle=t}function si(e){this._instance=null,this._intersection=e,this._intersection&&this.init()}function ci(e){var t=null!=(t=hi[e.region])?t:hi.cn;return li.init({app_id:t,channel:e.region,disable_auto_pv:!0}),li.config({user_unique_id:e.userUniqueId,evtParams:{app_id:t,ab_sdk_version:e.abSdkVersion,department:e.department,line_app_id:e.appId,os_type:"WEB"}}),li.start(),li}He.usePlugin(u,"ab"),He.usePlugin(p,"stay"),He.usePlugin(Qt,"store"),He.usePlugin(m,"autotrack"),He.usePlugin(Yt,"trackDuration"),He.usePlugin(h,"verify"),He.usePlugin(Xt,"verify"),He.usePlugin(f,"profile"),He.usePlugin(vt,"heartbeat"),He.usePlugin(g,"monitor"),He.usePlugin(l,"route");var li=new He("default"),hi={cn:2285,va:7054,sg:7054};function ui(e){if("undefined"!=typeof window)try{this.init(e),this.logger=D("Monitor"),this.logger("Image Monitor 2.0.2-v2 initialization completed")}catch(e){throw this.urgentBypassReport({data:d,code:v[d]}),e}}ui.prototype.init=function(e){var t;this.options=e,I.initConfigProvider({cloudConfig:this.options.enableCloudConfig?{channel:e.region,app_id:e.appId}:void 0,defaultConfig:{reportRateConfig:{reportRate:null!=(t=null==(t=null==(t=null==e?void 0:e.defaultConfig)?void 0:t.reportRateConfig)?void 0:t.reportRate)?t:1,reportRateError:null!=(t=null==(t=null==(t=null==e?void 0:e.defaultConfig)?void 0:t.reportRateConfig)?void 0:t.reportRateError)?t:1}}}),this.configProvider=I.getConfigProvider(),this.configProvider.updateConfig("monitorConfig",e),this.eventBroker=B.initEventBroker({tea:ci({region:e.region,appId:e.appId,userUniqueId:e.userUniqueId||""})}),this.producer=new V({el:this.configProvider.getConfig("monitorConfig").el,selector:this.configProvider.getConfig("monitorConfig").selector,broker:this.eventBroker})},ui.prototype.urgentBypassReport=function(e){ci({region:this.options.region,appId:this.options.appId,userUniqueId:this.options.userUniqueId||""}).event(M.System,e)},ui.prototype.start=function(){this.producer.start()},ui.prototype.stop=function(){this.producer.stop()},e.Monitor=ui,Object.defineProperty(e,"__esModule",{value:!0})}(t)}}]);
//# sourceMappingURL=lib-376a34f2.app.bc09a21fadaf86812738.js.map